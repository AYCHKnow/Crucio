"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var subject_list={"Allgemeine Pathologie":[],"Anästhesie und Intensivmedizin":[],Biochemie:["Chemie der Kohlenhydrate","Chemie der Aminosäuren, Peptide und Proteine","Chemie der Fettsäuren und Lipide","Chemie der Nukleotide und Nukleinsäuren","Vitamine und Koenzyme","Enzyme","Ernährung, Verdauung, Resorption","Abbau der Kohlenhydrate","Abbau der Fettsäuren, Ketonkörper","Aminosäurestoffwechsel","Zitratzyklus und Atmungskette","Glykogenstoffwechsel, Glukoneogenese","Biosynthese der Fettsäuren, Lipogenese","Mineral- und Elektrolythaushalt","Subzelluläre Strukturen","Nukleinsäuren, genetische Information, Molekularbiologie","Hormone","Immunchemie","Blut","Leber","Fettgewebe","Niere, Harn","Muskelgewebe, Bewegung","Binde- und Stützgewebe","Nervensystem"],Biologie:[],Chemie:[],Chirurgie:[],"Gynäkologie":[],Histologie:[],"Klinische Chemie":[],"Mikrobiologie / Virologie / Immunologie / Hygiene":[],Pharmakologie:[],Physik:[],Physiologie:["Allgemeine und Zellphysiologie, Zellerregung","Blut und Immunsystem","Herz","Blutkreislauf","Atmung","Arbeit- und Leistungsphysiologie","Ernährung, Verdauungstrakt, Leber","Energie- und Wärmehaushalt","Wasser- und Elektrolythaushalt, Nierenfunktion","Hormonale Regulationen","Sexualentwicklung und Reproduktionsphysiologie","Funktionsprinzipien des Nervensystems","Muskulatur","Vegetatives Nervensystem","Motorik","Somatoviszerale Sensorik","Visuelles System","Auditorisches System","Chemische Sinne","Integrative Leistungen des Zentralnervensystems"],Psychologie:[]};subject_list.Biologie=[],angular.module("crucioApp",["ngRoute","ngSanitize","ngCookies","ngTagsInput","ui.bootstrap","angular-loading-bar","angularFileUpload","angularSpinner","textAngular","angles","rzModule","duScroll","userModule","learnModule","authorModule","adminModule"]).config(function($routeProvider,$locationProvider){$routeProvider.when("/questions",{templateUrl:"views/questions.html",controller:"QuestionsController",controllerAs:"ctrl"}).when("/author",{templateUrl:"views/author.html",controller:"AuthorController",controllerAs:"ctrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminController",controllerAs:"ctrl"}).when("/global-statistic",{templateUrl:"views/global-statistic.html",controller:"GlobalStatisticController",controllerAs:"ctrl"}).when("/account",{templateUrl:"views/account.html",controller:"AccountController",controllerAs:"ctrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsController",controllerAs:"ctrl"}).when("/edit-exam",{templateUrl:"views/edit-exam.html",controller:"EditController",controllerAs:"ctrl"}).when("/question",{templateUrl:"views/question.html",controller:"QuestionController",controllerAs:"ctrl"}).when("/exam",{templateUrl:"views/exam.html",controller:"ExamController",controllerAs:"ctrl"}).when("/statistic",{templateUrl:"views/statistic.html",controller:"StatisticController",controllerAs:"ctrl"}).when("/analysis",{templateUrl:"views/analysis.html",controller:"AnalysisController",controllerAs:"ctrl"}).when("/help",{templateUrl:"views/help.html",controller:"HelpController",controllerAs:"ctrl"}).when("/403",{templateUrl:"views/403.html",controller:"ErrorController",controllerAs:"ctrl"}).when("/404",{templateUrl:"views/404.html",controller:"ErrorController",controllerAs:"ctrl"}).when("/500",{templateUrl:"views/500.html",controller:"ErrorController",controllerAs:"ctrl"}).otherwise({redirectTo:"/404"}),$locationProvider.html5Mode(!0)}).run(function(Auth,$location,$window){function routeInArray(array,route){var routeC=route;return route.indexOf("?")>-1&&(routeC=route.substr(0,route.indexOf("?"))),array.indexOf(routeC)>-1?1:0}var routesThatLogin=["/","/register","/forgot-password","/activate-account"],routesForAuthor=["/author","/edit-exam"],routesForAdmin=["/admin","/global-statistic"],user=Auth.tryGetUser(),isLoggedIn=0,isAdmin=0,isAuthor=0;user&&(isLoggedIn=user.group_id?1:0,isAdmin=2==user.group_id?1:0,isAuthor=3==user.group_id?1:0);var url=$location.url();routeInArray(routesThatLogin,url)&&isLoggedIn&&user.remember_user&&$window.location.replace("/questions"),!routeInArray(routesForAuthor,url)||isAuthor||isAdmin||$window.location.replace("/403"),routeInArray(routesForAdmin,url)&&!isAdmin&&$window.location.replace("/403")}),angular.module("adminModule",[]),angular.module("authorModule",[]),angular.module("learnModule",[]),angular.module("userModule",[]);var AboutController=function AboutController(Auth){_classCallCheck(this,AboutController),this.user=Auth.tryGetUser()};angular.module("crucioApp").controller("AboutController",AboutController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),AdminController=function(){function AdminController(Page,Auth,API,Selection,$scope,$uibModal){var _this=this;_classCallCheck(this,AdminController),this.API=API,this.Selection=Selection,this.$uibModal=$uibModal,Page.setTitleAndNav("Verwaltung | Crucio","Admin"),this.user=Auth.getUser(),this.activeTab="users",this.user_search={semester:"",group:"",login:"",query:"",query_keys:["group_name","username"]},this.comment_search={question_id:"",username:"",query:"",query_keys:["question","comment","username","question_id"]},this.update_activity=!1,this.show_activity={search_query:!1,result:!1,login:!1,register:!1,comment:!1,exam_new:!1,exam_update:!1},$scope.$watch(function(){return _this.comment_search},function(newValue){if(_this.questions_by_comment_display=[],_this.questions_by_comment){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this.questions_by_comment[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var comments=_step.value,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=comments[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var comment=_step2.value;if(_this.Selection.isElementIncluded(comment,newValue)){for(var foundIdx=-1,j=0;j<_this.questions_by_comment_display.length;j++)if(_this.questions_by_comment_display[j][0].question==comment.question){foundIdx=j;break}foundIdx>-1?_this.questions_by_comment_display[foundIdx].push(comment):_this.questions_by_comment_display.push([comment])}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}_this.questions_by_comment_display.sort(function(a,b){return b[0].date-a[0].date})},!0),this.API.get("users").success(function(result){_this.users=result.users,_this.distinct_semesters=_this.Selection.findDistinct(_this.users,"semester"),_this.distinct_semesters.sort(function(a,b){return a-b}),_this.distinct_groups=["Standard","Admin","Autor"],_this.ready=1}),this.API.get("comments").success(function(result){_this.comments=result.comments,_this.distinct_questions=_this.Selection.findDistinct(_this.comments,"question_id"),_this.distinct_users=_this.Selection.findDistinct(_this.comments,"username"),_this.questions_by_comment=[];var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=_this.comments[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){for(var c=_step3.value,found=-1,i=0;i<_this.questions_by_comment.length;i++)if(_this.questions_by_comment[i][0].question==c.question){found=i;break}found>-1?_this.questions_by_comment[found].push(c):_this.questions_by_comment.push([c])}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}_this.questions_by_comment_display=_this.questions_by_comment}),this.API.get("whitelist").success(function(result){_this.whitelist=result.whitelist}),this.API.get("stats/general").success(function(result){_this.stats=result.stats})}return _createClass(AdminController,[{key:"addMail",value:function(){var email=this.new_whitelist_mail;if(email.length){this.whitelist.push({username:"",mail_address:email});var data={mail_address:email.replace("@","(@)")};this.API.post("whitelist",data)}}},{key:"removeMail",value:function(index){var email=this.whitelist[index].mail_address;email.length&&(this.whitelist.splice(index,1),this.API["delete"]("whitelist/"+email))}},{key:"changeGroup",value:function(index){var userId=this.users[index].user_id,groupId=this.users[index].group_id;if(1==userId)return!1;2==groupId?(groupId=1,this.users[index].group_name="Standard"):3==groupId?(groupId=2,this.users[index].group_name="Admin"):(groupId=3,this.users[index].group_name="Autor");var data={group_id:groupId};this.users[index].group_id=groupId,this.API.put("users/"+userId+"/group",data)}},{key:"isToday",value:function(dateString){var today=new Date,date=new Date(1e3*dateString);return today.toDateString()==date.toDateString()?!0:!1}},{key:"isYesterday",value:function(dateString){var today=new Date,diff=today-864e5,yesterday=new Date(diff),date=new Date(1e3*dateString);return yesterday.toDateString()==date.toDateString()?!0:!1}},{key:"userInSelection",value:function(index){return this.Selection.isElementIncluded(this.users[index],this.user_search)}},{key:"userInSelectionCount",value:function(){return this.Selection.count(this.users,this.user_search)}},{key:"commentInSelectionCount",value:function(){return this.Selection.count(this.comments,this.comment_search)}},{key:"increaseSemester",value:function(){var data={number:"1"};this.API.post("admin/change-semester/dFt(45i$hBmk*I",data).success(function(result){alert(result.status)})}},{key:"decreaseSemester",value:function(){var data={number:"-1"};this.API.post("admin/change-semester/dFt(45i$hBmk*I",data).success(function(result){alert(result.status)})}},{key:"removeTestAccount",value:function(){this.API["delete"]("users/test-account").success(function(result){alert(result.status)})}}]),AdminController}();angular.module("adminModule").controller("AdminController",AdminController);var GlobalStatisticController=function GlobalStatisticController(Page,Auth,API,$interval){var _this2=this;_classCallCheck(this,GlobalStatisticController),this.API=API,Page.setTitleAndNav("Statistik | Crucio","Admin"),this.user=Auth.getUser(),this.activeTab="stats",this.update_activity=!1,this.show_activity={search_query:!1,result:!1,login:!1,register:!1,comment:!1,exam_new:!1,exam_update:!1},this.reloadData=function(){var _this=this,first=!0;this.API.get("stats/general").success(function(result){_this.stats=result.stats,first&&(_this.chart_questions={labels:["Gesamt","Sichtbar","Mit Lösung","Mit Erklärung","Mit Kategorie","Freie Frage"],datasets:[{data:[_this.stats.question_count,_this.stats.visible_question_count,_this.stats.question_count-_this.stats.question_without_answer_count,_this.stats.question_explanation_count,_this.stats.question_topic_count,_this.stats.question_free_count]}]},_this.chart_time_result_today={labels:_this.stats.result_dep_time_today_label,datasets:[{label:"My Second dataset",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:_this.stats.result_dep_time_today}]},first=!1)}),this.API.get("stats/search-queries").success(function(result){_this.search_queries=result.search_queries}),this.API.post("stats/activities",this.show_activity).success(function(result){_this.activities=result.activities})},this.reloadData(),$interval(function(){_this2.update_activity&&_this2.reloadData()},2400)};angular.module("adminModule").controller("GlobalStatisticController",GlobalStatisticController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),AuthorController=function(){function AuthorController(Page,Auth,API,Selection,$scope,$location){var _this=this;_classCallCheck(this,AuthorController),this.API=API,this.Selection=Selection,this.$location=$location,Page.setTitleAndNav("Autor | Crucio","Autor"),this.user=Auth.getUser(),this.activeTab="exams",this.subject_list=subject_list,this.exam_search={subject:"",semester:"",author:this.user.username,query:"",query_keys:["subject","author","date"]},this.comment_search={username_added:"",username:"",query:"",query_keys:["question","comment","username","question_id"]},$scope.$watch(function(){return _this.comment_search},function(newValue){if(_this.questions_by_comment_display=[],_this.questions_by_comment){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this.questions_by_comment[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var comments=_step.value,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=comments[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var comment=_step2.value;if(_this.Selection.isElementIncluded(comment,newValue)){for(var foundIdx=-1,j=0;j<_this.questions_by_comment_display.length;j++)if(_this.questions_by_comment_display[j][0].question==comment.question){foundIdx=j;break}foundIdx>-1?_this.questions_by_comment_display[foundIdx].push(comment):_this.questions_by_comment_display.push([comment])}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}_this.questions_by_comment_display.sort(function(a,b){return b[0].date-a[0].date})},!0),this.API.get("exams").success(function(result){_this.exams=result.exams,_this.distinct_semesters=_this.Selection.findDistinct(_this.exams,"semester"),_this.distinct_subjects=_this.Selection.findDistinct(_this.exams,"subject"),_this.distinct_authors=_this.Selection.findDistinct(_this.exams,"author"),_this.ready=1}),this.API.get("comments/author/"+this.user.user_id).success(function(result){_this.comments=result.comments,_this.distinct_users=[],_this.distinct_users_added=[],_this.distinct_users=_this.Selection.findDistinct(_this.comments,"username"),_this.distinct_users_added=_this.Selection.findDistinct(_this.comments,"username_added"),_this.questions_by_comment=[];var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=_this.comments[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){for(var c=_step3.value,found=-1,i=0;i<_this.questions_by_comment.length;i++)if(_this.questions_by_comment[i][0].question==c.question){found=i;break}found>0?_this.questions_by_comment[found].push(c):_this.questions_by_comment.push([c])}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}_this.questions_by_comment.sort(function(a,b){return b[0].date-a[0].date}),_this.questions_by_comment_display=_this.questions_by_comment,_this.comment_search.username_added=_this.user.username})}return _createClass(AuthorController,[{key:"new_exam",value:function(){var _this2=this,data={subject:"",professor:"",semester:"",date:"",type:"",user_id_added:this.user.user_id,duration:"",notes:""};this.API.post("exams",data).success(function(result){_this2.$location.path("/edit-exam").search("id",result.exam_id)})}},{key:"comment_in_selection",value:function(index){return this.Selection.isElementIncluded(this.comments[index],this.comment_search)}},{key:"comment_in_selection_count",value:function(){return this.Selection.count(this.comments,this.comment_search)}},{key:"exam_in_selection",value:function(index){return this.Selection.isElementIncluded(this.exams[index],this.exam_search)}},{key:"exam_in_selection_count",value:function(){return this.Selection.count(this.exams,this.exam_search)}}]),AuthorController}();angular.module("authorModule").controller("AuthorController",AuthorController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EditController=function(){function EditController(Page,Auth,API,FileUploader,$scope,$location,$routeParams,$timeout){var _this=this;_classCallCheck(this,EditController),this.API=API,this.FileUploader=FileUploader,this.$location=$location,this.$timeout=$timeout,Page.setTitleAndNav("Klausur | Crucio","Autor"),this.ready=0,this.user=Auth.getUser(),this.exam_id=$routeParams.id,this.open_question_index=-1,this.subject_list=subject_list,this.has_changed=0,this.number_changed=0,this.is_saving=0,this.uploader=new FileUploader({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(fileItem,response){_this.exam.file_name=response.upload_name},this.uploader_array=[],$scope.$watch(function(){return _this.exam},function(){_this.number_changed>1&&(_this.has_changed=1),_this.number_changed+=1},!0),$scope.$on("$locationChangeStart",function(event){if(1==_this.has_changed){var confirmClose=confirm("Die Änderungen an der Klausur bleiben dann ungespeichert. Wirklich verlassen?");confirmClose||event.preventDefault()}}),this.API.get("exams/"+this.exam_id).success(function(result){_this.exam=result,_this.exam.semester=Number(result.semester),_this.exam.duration=Number(result.duration);for(var i=0;i<_this.exam.questions.length;i++)0===_this.exam.questions[i].topic.length&&(_this.exam.questions[i].topic="Sonstiges"),_this.exam.questions[i].question_id==$routeParams.question_id&&(_this.open_question_index=i);_this.remakeUploaderArray(),0===_this.exam.questions.length&&_this.addQuestion(!1),_this.exam.subject||(_this.exam.subject="Allgemeine Pathologie",_this.exam.sort="Erstklausur"),_this.ready=1})}return _createClass(EditController,[{key:"remakeUploaderArray",value:function(){var _this2=this;this.uploader_array=[];for(var i=0;i<this.exam.questions.length;i++){var uploader=new this.FileUploader({url:"/api/v1/file/upload",formData:i});uploader.onSuccessItem=function(fileItem,response){var index=fileItem.formData;_this2.exam.questions[index].question_image_url=response.upload_name},this.uploader_array.push(uploader)}}},{key:"addQuestion",value:function(show){var question={question:"",type:5,correct_answer:0,answers:["","","","","",""],topic:"Sonstiges"};this.exam.questions.push(question),show&&(this.open_question_index=this.exam.questions.length-1),this.remakeUploaderArray()}},{key:"deleteQuestion",value:function(index){var questionId=this.exam.questions[index].question_id;questionId&&this.API["delete"]("questions/"+questionId),this.exam.questions.splice(index,1),this.remakeUploaderArray(),this.open_question_index>=this.exam.questions.length&&(this.open_question_index=this.exam.questions.length-1),0===this.exam.questions.length&&this.addQuestion(1)}},{key:"saveExam",value:function(){var _this3=this,validate=!0;if(this.exam.subject||(validate=!1),this.exam.semester<1&&(validate=!1),this.exam.date||(validate=!1),validate){this.is_saving=1;var examData=this.exam;this.API.put("exams/"+this.exam_id,examData);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_loop=function(){var question=_step.value,validateQuestion=!0;if(question.question.length||(validateQuestion=!1),question.question_id&&(validateQuestion=!0),validateQuestion){question.explanation||(question.explanation=""),question.question_image_url||(question.question_image_url="");var data={question:question.question,topic:question.topic,type:question.type,answers:question.answers,correct_answer:question.correct_answer,exam_id:_this3.exam.exam_id,user_id_added:_this3.user.user_id,explanation:question.explanation,question_image_url:question.question_image_url};question.question_id?_this3.API.put("questions/"+question.question_id,data):_this3.API.post("questions",data).success(function(result){question.question_id=result.question_id})}},_iterator=this.exam.questions[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)_loop()}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}this.has_changed=0,this.is_saving=0}else alert("Es fehlen noch allgemeine Infos zur Klausur.")}},{key:"deleteExam",value:function(){var _this4=this;this.API["delete"]("exams/"+this.exam.exam_id).success(function(){_this4.$location.url("/author")})}}]),EditController}();angular.module("authorModule").controller("EditController",EditController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ContactController=function(){function ContactController(Auth,API,$location,$scope,$modal){var _this=this;_classCallCheck(this,ContactController),this.API=API,this.$modal=$modal,this.user=Auth.tryGetUser(),this.text="",this.user&&(this.name=this.user.username,this.email=this.user.email),this.is_working=!1,$scope.$watch(function(){return _this.name},function(){_this.error_no_name=0},!0),$scope.$watch(function(){return _this.email},function(){_this.error_no_email=0},!0)}return _createClass(ContactController,[{key:"validateMail",value:function(email){var regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return regex.test(email)?!1:!0}},{key:"sendMail",value:function(){var _this2=this,text=this.text,validationPassed=1;if(this.name||(validationPassed=0,this.error_no_name=1),this.validateMail(this.email)&&(validationPassed=0,this.error_no_email=1),validationPassed){this.is_working=!0;var data={name:this.name,email:this.email.replace("@","(@)"),text:text};this.API.post("contact/send-mail",data).success(function(){_this2.is_working=!1,_this2.email_send=!0,_this2.open()})}}},{key:"open",value:function(){this.$modal.open({templateUrl:"myModalContent.html"})}}]),ContactController}();angular.module("crucioApp").controller("ContactController",ContactController);var ErrorController=function ErrorController(Auth,Page){_classCallCheck(this,ErrorController),Page.setTitleAndNav("Fehler | Crucio",""),this.user=Auth.tryGetUser()};angular.module("crucioApp").controller("ErrorController",ErrorController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),HelpController=function(){function HelpController(Auth,Page,API,$location,$scope,$modal){var _this=this;_classCallCheck(this,HelpController),this.API=API,this.$modal=$modal,Page.setTitleAndNav("Hilfe | Crucio",""),this.user=Auth.getUser();var routeParams=$location.search();this.question_id=routeParams.question_id,this.subject=routeParams.s,"Antwort"==this.subject&&(this.subject="Falsche Antwort"),this.text="",this.question_id&&this.API.get("questions/"+this.question_id).success(function(result){_this.question=result.question}),this.is_working=!1}return _createClass(HelpController,[{key:"sendMail",value:function(){var _this2=this,text=this.text,validationPassed=1;if(0===this.text.length&&(validationPassed=0),validationPassed)if(this.is_working=!0,this.question_id){var data={name:this.user.username,email:this.user.email.replace("@","(@)"),text:text,question_id:this.question_id,author:this.question.username,question:this.question.question,exam_id:this.question.exam_id,subject:this.question.subject,date:this.question.date,author_email:this.question.email,mail_subject:this.subject};this.API.post("contact/send-mail-question",data).success(function(){_this2.is_working=!1,_this2.email_send=!0,_this2.open()})}else{var data={name:this.user.username,email:this.user.email.replace("@","(@)"),text:text};this.API.post("contact/send-mail",data).success(function(){_this2.is_working=!1,_this2.email_send=!0,_this2.open()})}}}]),HelpController}();angular.module("crucioApp").controller("HelpController",HelpController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),AnalysisController=function(){function AnalysisController(Page,Auth,API){function getArrayByKey(array,name){var result=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=array[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var e=_step2.value;e[name]&&result.push(e)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return result}var _this=this;_classCallCheck(this,AnalysisController),this.API=API,Page.setTitleAndNav("Analyse | Crucio","Lernen"),this.user=Auth.getUser(),this.questionList=angular.fromJson(sessionStorage.currentQuestionList);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.questionList.list[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var question=_step.value;if(!question.mark_answer&&question.type>1&&question.given_result>0){var correct=question.correct_answer==question.given_result?1:0;
0===question.correct_answer&&(correct=-1),1==question.question.type&&(correct=-1);var data={correct:correct,question_id:question.question_id,user_id:this.user.user_id,given_result:question.given_result};this.API.post("results",data)}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}this.get_random=function(min,max){if(min>max)return-1;if(min==max)return min;var r=void 0;do r=Math.random();while(1==r);return min+parseInt(r*(max-min+1),0)},this.workedQuestionList=getArrayByKey(this.questionList.list,"given_result"),this.exam_id=this.questionList.exam_id,this.all_question_count=this.questionList.list.length,this.worked_question_count=this.workedQuestionList.length,this.correct_q_count=0,this.wrong_q_count=0,this.seen_q_count=0,this.solved_q_count=0,this.free_q_count=0,this.no_answer_q_count=0,this.random=this.get_random(0,1e3);var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=this.workedQuestionList[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var question2=_step3.value;question2.correct_answer==question2.given_result&&question2.given_result>0&&question2.correct_answer>0&&this.correct_q_count++,question2.correct_answer!=question2.given_result&&question2.given_result>0&&question2.correct_answer>0&&this.wrong_q_count++,question2.given_result>0&&this.solved_q_count++,question2.given_result>-2&&this.seen_q_count++,1==question2.type&&this.free_q_count++,0===question2.correct_answer&&1!=question2.type&&this.no_answer_q_count++}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}this.exam_id&&this.API.get("exams/"+this.exam_id).success(function(result){_this.exam=result})}return _createClass(AnalysisController,[{key:"showCorrectAnswerClicked",value:function(index){this.workedQuestionList[index].show_correct_answer=1}}]),AnalysisController}();angular.module("learnModule").controller("AnalysisController",AnalysisController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ExamController=function(){function ExamController(Page,Auth,API,$location,$uibModal,$routeParams,$timeout,$document){var _this=this;_classCallCheck(this,ExamController),this.API=API,this.$location=$location,this.$document=$document,this.$uibModal=$uibModal,Page.setTitleAndNav("Klausur | Crucio","Lernen"),this.user=Auth.getUser(),this.exam_id=$routeParams.id,this.questionList={exam_id:this.exam_id,list:[]},this.current_index=0,this.API.get("exams/"+this.exam_id).success(function(result){_this.exam=result;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this.exam.questions[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var question=_step.value;_this.questionList.list.push(question)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}),$document.on("scroll",function(){for(var positionTop=$document.scrollTop(),_loop=function(i){var question=angular.element(document.getElementById("id"+i));return question.prop("offsetTop")>positionTop?($timeout(function(){_this.current_index=Math.max(i-1,0)},0),"break"):void 0},i=0;i<_this.exam.questions.length;i++){var _ret=_loop(i);if("break"===_ret)break}})}return _createClass(ExamController,[{key:"isHalftime",value:function(index){return Math.abs(index+1-this.exam.question_count/2)<1&&index>3}},{key:"saveAnswer",value:function(index,given_answer){this.questionList.list[index].given_result=String(given_answer)}},{key:"scrollToTop",value:function(){this.$document.scrollTopAnimated(0,400)}},{key:"handExam",value:function(){sessionStorage.currentQuestionList=angular.toJson(this.questionList),this.$location.path("/analysis").search("id",null)}},{key:"openImageModal",value:function(fileName){this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{image_url:function(){return fileName}}})}}]),ExamController}();angular.module("learnModule").controller("ExamController",ExamController);var ModalInstanceController=function ModalInstanceController(image_url,$modalInstance){_classCallCheck(this,ModalInstanceController),this.image_url=image_url,this.$modalInstance=$modalInstance};angular.module("learnModule").controller("ModalInstanceController",ModalInstanceController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),QuestionController=function(){function QuestionController(Auth,Page,API,$scope,$routeParams,$location,$window,$uibModal){function getIndexBy(array,name,value){for(var i=0;i<array.length;i++)if(array[i][name]==value)return i}var _this=this;_classCallCheck(this,QuestionController),this.Auth=Auth,this.API=API,this.$location=$location,this.$uibModal=$uibModal,Page.setTitleAndNav("Frage | Crucio","Lernen"),this.answerButtonClass="btn-primary",this.user=Auth.getUser(),this.questionList=angular.fromJson(sessionStorage.currentQuestionList),this.question_id=$routeParams.id,this.reset_session=$routeParams.reset_session,this.question_id||this.$window.location.replace("/questions"),this.show_explanation=0,this.given_result=0,this.strike={},this.reset_session&&(this.questionList={},sessionStorage.currentQuestionList=angular.toJson(this.questionList)),this.questionList&&Object.keys(this.questionList).length&&(this.index=getIndexBy(this.questionList.list,"question_id",this.question_id),this.length=this.questionList.list.length,this.show_answer=this.questionList.list[this.index].mark_answer,this.given_result=this.questionList.list[this.index].given_result,this.questionList.list[this.index].strike&&(this.strike=this.questionList.list[this.index].strike)),$scope.$watch(function(){return _this.strike},function(newValue){_this.questionList&&Object.keys(_this.questionList).length&&(_this.questionList.list[_this.index].strike=newValue,sessionStorage.currentQuestionList=angular.toJson(_this.questionList))},!0),API.get("questions/"+this.question_id+"/user/"+this.user.user_id).success(function(result){_this.question=result;for(var i=0;i<_this.question.comments.length;i++)_this.question.comments[i].voting=parseInt(_this.question.comments[i].voting,0)||0,_this.question.comments[i].user_voting=parseInt(_this.question.comments[i].user_voting,0)||0;if(_this.question.tags){var array=_this.question.tags.split(",");_this.question.tags=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=array[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var element=_step.value;_this.question.tags.push({text:element})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}else _this.question.tags=[];_this.given_result&&_this.check_answer(_this.given_result),_this.show_answer&&_this.mark_answer(_this.given_result)})}return _createClass(QuestionController,[{key:"updateTags",value:function(){var string="",_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=this.question.tags[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var tag=_step2.value;string+=tag.text+","}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}string=string.slice(0,-1);var data={tags:string,question_id:this.question_id,user_id:this.user.user_id};this.API.post("tags",data)}},{key:"show_solution",value:function(){var correctAnswer=this.correct_answer(),correct=correctAnswer==this.given_result?1:0;0===correctAnswer&&(correct=-1),1==this.question.type&&(correct=-1);var data={correct:correct,question_id:this.question_id,user_id:this.user.user_id,given_result:this.given_result};this.API.post("results",data),this.questionList&&Object.keys(this.questionList).length&&(this.questionList.list[this.index].mark_answer=1,sessionStorage.currentQuestionList=angular.toJson(this.questionList)),this.mark_answer(this.given_result)}},{key:"save_answer",value:function(givenAnswer){this.given_result=givenAnswer,this.questionList&&Object.keys(this.questionList).length&&(this.questionList.list[this.index].given_result=givenAnswer,sessionStorage.currentQuestionList=angular.toJson(this.questionList))}},{key:"check_answer",value:function(answer){this.checked_answer=answer}},{key:"correct_answer",value:function(){return this.question.correct_answer}},{key:"mark_answer",value:function(givenAnswer){this.mark_answer_free=!0;var type=this.question.type,correctAnswer=this.correct_answer();type>1?(this.check_answer(givenAnswer),givenAnswer==correctAnswer?(this.correctAnswer=givenAnswer,this.answerButtonClass="btn-success"):(this.wrongAnswer=givenAnswer,this.correctAnswer=correctAnswer,this.answerButtonClass="btn-danger")):1==type&&(this.answerButtonClass="btn-info")}},{key:"add_comment",value:function(){var _this2=this,now=new Date/1e3,data={comment:this.commentText,question_id:this.question_id,reply_to:0,username:this.user.username,date:now};this.API.post("comments/"+this.user.user_id,data).success(function(result){data.voting=0,data.user_voting=0,data.comment_id=result.comment_id,_this2.question.comments.push(data),_this2.commentText=""})}},{key:"delete_comment",value:function(index){var commentId=this.question.comments[index].comment_id;this.API["delete"]("comments/"+commentId),this.question.comments.splice(index,1)}},{key:"increase_user_voting",value:function(currentUserVoting,commentId){var result=Math.min(currentUserVoting+1,1),data={user_voting:result};return this.API.post("comments/"+commentId+"/user/"+this.user.user_id,data),result}},{key:"decrease_user_voting",value:function(currentUserVoting,commentId){var result=Math.max(currentUserVoting-1,-1),data={user_voting:result};return this.API.post("comments/"+commentId+"/user/"+this.user.user_id,data),result}},{key:"open_image_model",value:function(){var _this3=this;this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{image_url:function(){return _this3.question.question_image_url}}})}}]),QuestionController}();angular.module("learnModule").controller("QuestionController",QuestionController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),QuestionsController=function(){function QuestionsController(Auth,Page,API,Selection,$scope,$location){var _this=this;_classCallCheck(this,QuestionsController),this.API=API,this.Selection=Selection,this.$location=$location,Page.setTitleAndNav("Lernen | Crucio","Lernen"),this.user=Auth.getUser(),this.activeTab="abstract",this.exam_search={subject:"",semester:"",query:"",query_keys:["subject","semester","date"]},this.comment_search={query:"",query_keys:["comment","username","question_id"]},this.tag_search={query:"",query_keys:["tag"]},this.subject_list=subject_list,this.question_field_message="",this.selection_subject_list={},this.selection_number_questions=0,this.number_questions_in_choosen_subjects=0,this.conditions=1,this.show_spinner=!1,this.slider_options={floor:0,ceil:this.number_questions_in_choosen_subjects},$scope.$watch(function(){return _this.selection_subject_list},function(){var data={ignoreLoadingBar:!0,selection_subject_list:_this.selection_subject_list};_this.API.post("learn/number-questions",data).success(function(result){_this.number_questions_in_choosen_subjects=result.number_questions,0===_this.selection_number_questions&&(_this.selection_number_questions=Math.min(_this.number_questions_in_choosen_subjects,50)),_this.selection_number_questions>_this.number_questions_in_choosen_subjects&&(_this.selection_number_questions=_this.number_questions_in_choosen_subjects)})},!0),$scope.$watch(function(){return _this.number_questions_in_choosen_subjects},function(){var max=_this.number_questions_in_choosen_subjects;max>200&&(max=200);var step=10;100>max&&(step=10),40>max&&(step=4),20>max&&(step=1),200>max&&max%step!==0&&(max+=step),_this.slider_options={floor:0,ceil:max}},!0),this.API.get("exams/user_id/"+this.user.user_id).success(function(result){_this.exams=result.exam,_this.distinct_semesters=Selection.findDistinct(_this.exams,"semester"),_this.distinct_subjects=Selection.findDistinct(_this.exams,"subject"),_this.abstract_exams=[];var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this.exams[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var entry=_step.value,select=!0;entry.semester!=_this.user.semester&&(select=!1),"unbekannt"==entry.date&&(select=!1),_this.exams.length>10&&entry.question_count<30&&(select=!1),entry.answered_questions>0&&(select=!0),select&&(entry.answered_questions>0?_this.abstract_exams.unshift(entry):_this.abstract_exams.push(entry))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}_this.ready=1});var data={user_id:this.user.user_id};this.API.get("tags",data).success(function(result){_this.tags=result.tags,_this.distinct_tags=[];var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=_this.tags[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var entry=_step2.value,_iteratorNormalCompletion5=!0,_didIteratorError5=!1,_iteratorError5=void 0;try{for(var _step5,_iterator5=entry.tags.split(",")[Symbol.iterator]();!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=!0){var tagText=_step5.value;-1==_this.distinct_tags.indexOf(tagText)&&_this.distinct_tags.push(tagText)}}catch(err){_didIteratorError5=!0,_iteratorError5=err}finally{try{!_iteratorNormalCompletion5&&_iterator5["return"]&&_iterator5["return"]()}finally{if(_didIteratorError5)throw _iteratorError5}}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}_this.questions_by_tag={};var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=_this.distinct_tags[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var distinctTag=_step3.value;_this.questions_by_tag[distinctTag]=[]}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=_this.distinct_tags[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var distinctTag=_step4.value,_iteratorNormalCompletion6=!0,_didIteratorError6=!1,_iteratorError6=void 0;try{for(var _step6,_iterator6=_this.tags[Symbol.iterator]();!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=!0){var entry=_step6.value,_iteratorNormalCompletion7=!0,_didIteratorError7=!1,_iteratorError7=void 0;try{for(var _step7,_iterator7=entry.tags.split(",")[Symbol.iterator]();!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=!0){var tagText=_step7.value;distinctTag==tagText&&_this.questions_by_tag[distinctTag].push(entry)}}catch(err){_didIteratorError7=!0,_iteratorError7=err}finally{try{!_iteratorNormalCompletion7&&_iterator7["return"]&&_iterator7["return"]()}finally{if(_didIteratorError7)throw _iteratorError7}}}}catch(err){_didIteratorError6=!0,_iteratorError6=err}finally{try{!_iteratorNormalCompletion6&&_iterator6["return"]&&_iterator6["return"]()}finally{if(_didIteratorError6)throw _iteratorError6}}}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}}),this.API.get("comments/"+this.user.user_id).success(function(result){_this.comments=result.comments,_this.questions_by_comment={};var _iteratorNormalCompletion8=!0,_didIteratorError8=!1,_iteratorError8=void 0;try{for(var _step8,_iterator8=_this.comments[Symbol.iterator]();!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=!0){var comment=_step8.value;_this.questions_by_comment[comment.question]=[]}}catch(err){_didIteratorError8=!0,_iteratorError8=err}finally{try{!_iteratorNormalCompletion8&&_iterator8["return"]&&_iterator8["return"]()}finally{if(_didIteratorError8)throw _iteratorError8}}var _iteratorNormalCompletion9=!0,_didIteratorError9=!1,_iteratorError9=void 0;try{for(var _step9,_iterator9=_this.comments[Symbol.iterator]();!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=!0){var comment=_step9.value;_this.questions_by_comment[comment.question].push(comment)}}catch(err){_didIteratorError9=!0,_iteratorError9=err}finally{try{!_iteratorNormalCompletion9&&_iterator9["return"]&&_iterator9["return"]()}finally{if(_didIteratorError9)throw _iteratorError9}}})}return _createClass(QuestionsController,[{key:"learnExam",value:function(examId){var _this2=this,random=1;this.API.get("exams/action/prepare/"+examId+"/"+random).success(function(result){var questionList={list:result.list};questionList.exam_id=examId,sessionStorage.currentQuestionList=angular.toJson(questionList),_this2.$location.path("/question").search("id",questionList.list[0].question_id)})}},{key:"learnSubjects",value:function(){var _this3=this,data={selection_subject_list:this.selection_subject_list,selection_number_questions:this.selection_number_questions};this.API.post("learn/prepare",data).success(function(result){var questionList={list:result.list};questionList.selection_subject_list=data.selection_subject_list,sessionStorage.currentQuestionList=angular.toJson(questionList),_this3.$location.path("/question").search("id",questionList.list[0].question_id)})}},{key:"resetResults",value:function(index){var examId=this.exams[index].exam_id;this.exams[index].answered_questions=0;var data={};this.API["delete"]("results/"+this.user.user_id+"/"+examId,data)}},{key:"resetAbstractResults",value:function(index){var examId=this.abstract_exams[index].exam_id;this.abstract_exams[index].answered_questions=0;var data={};this.API["delete"]("results/"+this.user.user_id+"/"+examId,data)}},{key:"toggleSelection",value:function(subject,category){var checked=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],selection=this.selection_subject_list,subjects=this.subject_list;if(Object.keys(selection).indexOf(subject)>-1)if(0===selection[subject].length)"all"==category&&delete selection[subject];else if(selection[subject].length>0)if("all"==category)checked?delete selection[subject]:selection[subject]=subjects[subject].slice(0);else{var idx=selection[subject].indexOf(category);idx>-1?(selection[subject].splice(idx,1),0===selection[subject].length&&delete selection[subject]):selection[subject].push(category)}else"all"==category?selection[subject]=subjects[subject].slice(0):selection[subject]=[category];else"all"==category?selection[subject]=subjects[subject].slice(0):selection[subject]=[category]}},{key:"searchQuestion",value:function(){var _this4=this;this.search_results=[];var query_question=this.question_search_query;if(this.question_field_message="",query_question.length){this.show_spinner=!0;var data={query:this.question_search_query,visibility:1,limit:101};this.API.get("questions",data).success(function(result){_this4.show_spinner=!1,0===result.result.length?_this4.question_field_message="Nichts gefunden ;(":result.result.length>100?_this4.question_field_message="Zu viel gefunden, geht es ein bisschen konkreter? ;(":_this4.search_results=result.result})}}},{key:"examInSelection",value:function(index){return this.Selection.isElementIncluded(this.exams[index],this.exam_search)}},{key:"examInSelectionCount",value:function(){return this.Selection.count(this.exams,this.exam_search)}}]),QuestionsController}();angular.module("userModule").controller("QuestionsController",QuestionsController);var StatisticController=function StatisticController(Auth,Page){_classCallCheck(this,StatisticController),Page.setTitleAndNav("Statistik | Crucio","Lernen"),this.user=Auth.getUser()};angular.module("learnModule").controller("StatisticController",StatisticController);var TitleController=function TitleController(Page){_classCallCheck(this,TitleController),this.Page=Page};angular.module("crucioApp").controller("TitleController",TitleController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),AccountController=function(){function AccountController(Page,Auth,API,Validate,$scope){var _this=this;_classCallCheck(this,AccountController),this.API=API,this.Auth=Auth,this.Validate=Validate,Page.setTitleAndNav("Account | Crucio","Name"),this.user=this.Auth.getUser(),this.user.semester=Number(this.user.semester),this.old_password="",this.wrong_password=!1,this.submit_button_title="Speichern",$scope.$watch(function(){return _this.user.email},function(newValue,oldValue){newValue!=oldValue&&(_this.submit_button_title="Speichern")},!0),$scope.$watch(function(){return _this.old_password},function(newValue,oldValue){newValue!=oldValue&&(_this.submit_button_title="Speichern",_this.wrong_password=!1)},!0),$scope.$watch(function(){return _this.new_password},function(newValue,oldValue){newValue!=oldValue&&(_this.submit_button_title="Speichern")},!0),$scope.$watch(function(){return _this.new_password_c},function(newValue,oldValue){newValue!=oldValue&&(_this.submit_button_title="Speichern")},!0)}return _createClass(AccountController,[{key:"saveUser",value:function(){var _this2=this,validate=!0;if(this.Validate.email(this.user.email)||(validate=!1),this.user.semester<1&&(validate=!1),this.user.semester>30&&(validate=!1),this.old_password.length>0&&(this.new_password.length<6&&(validate=!1),this.new_password!=this.new_password_c&&(validate=!1)),validate){this.submit_button_title="Speichern...";var data={email:this.user.email.replace("@","(@)"),course_id:this.user.course_id,semester:this.user.semester,current_password:this.old_password,password:this.new_password};this.API.put("users/"+this.user.user_id+"/account",data).success(function(result){"success"==result.status?(_this2.Auth.setUser(_this2.user),_this2.submit_button_title="Gespeichert"):(_this2.user=_this2.Auth.getUser(),"error_incorrect_password"==result.status&&(_this2.wrong_password=!0),_this2.submit_button_title="Speichern nicht möglich...")})}else this.submit_button_title="Speichern nicht möglich..."}}]),AccountController}();angular.module("userModule").controller("AccountController",AccountController);var ActivateController=function ActivateController(Auth,API,$location){var _this=this;if(_classCallCheck(this,ActivateController),this.API=API,this.user=Auth.tryGetUser(),this.token=$location.search().token,this.token){var data={token:this.token};this.API.post("users/action/activate",data).success(function(result){"error_unknown"==result.status?(_this.success=0,_this.error_no_token=0,_this.error_unknown=1):"error_no_token"==result.status?(_this.success=0,_this.error_no_token=1,_this.error_unknown=0):"success"==result.status&&(_this.success=1,_this.error_no_token=0,_this.error_unknown=0)})}else this.success=0,this.error_no_token=1};angular.module("userModule").controller("ActivateController",ActivateController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ForgotPasswordController=function(){function ForgotPasswordController(Auth,API,$location,$scope){var _this=this;if(_classCallCheck(this,ForgotPasswordController),this.API=API,this.user=Auth.tryGetUser(),angular.isUndefined(this.user)&&(this.user={email:""}),this.confirm=$location.search().confirm,this.deny=$location.search().deny,this.is_working=0,this.error_email=0,this.error_already_requested=0,this.confirm||this.deny||(this.reset=1),this.confirm){this.reset=0;var data={token:this.confirm};this.API.post("users/password/confirm",data).success(function(result){_this.status=result.status,$("#forgotConfirmModal").modal("show")})}if(this.deny){this.reset=0;var data={token:this.deny};API.post("users/password/deny",data).success(function(result){_this.status=result.status,$("#forgotDenyModal").modal("show")})}$scope.$watch(function(){return _this.user.email},function(){_this.error_email=0,_this.error_already_requested=0},!0)}return _createClass(ForgotPasswordController,[{key:"resetPassword",value:function(){var _this2=this,validate=!0;if(this.user?this.user.email||(validate=!1,this.error_email=1):(validate=!1,this.error_email=1),validate){this.is_working=1;var data={email:this.user.email.replace("@","(@)")};this.API.post("users/password/reset",data).success(function(result){_this2.is_working=0,result?"success"==result.status?(_this2.error_email=0,_this2.error_already_requested=0,$("#forgotSucessModal").modal("show")):"error_email"==result.status?_this2.error_email=1:"error_already_requested"==result.status&&(_this2.error_already_requested=1):_this2.error_email=1})}}}]),ForgotPasswordController}();angular.module("userModule").controller("ForgotPasswordController",ForgotPasswordController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),LoginController=function(){function LoginController(Auth,Page,API,$scope,$document){var _this=this;_classCallCheck(this,LoginController),this.Page=Page,this.Auth=Auth,this.API=API,this.$document=$document,this.user=this.Auth.tryGetUser(),this.email="",this.remember_me=!0,this.password="",this.login_error=!1,$scope.$watch(function(){return _this.email},function(){_this.login_error=!1},!0),$scope.$watch(function(){return _this.password},function(){_this.login_error=!1},!0)}return _createClass(LoginController,[{key:"login",value:function(){var _this2=this;this.email&&-1==this.email.indexOf("@")&&(this.email+="@studserv.uni-leipzig.de");var data={email:this.email.replace("@","(@)"),remember_me:this.remember_me,password:this.password};this.API.post("users/action/login",data).success(function(result){"success"==result.login?_this2.Auth.login(result.logged_in_user,_this2.remember_me):_this2.login_error=!0})}},{key:"scrollToFeatures",value:function(){this.$document.scrollTopAnimated(1050,600)}}]),LoginController}();angular.module("userModule").controller("LoginController",LoginController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),LogoutController=function(){function LogoutController(Auth,Page){_classCallCheck(this,LogoutController),this.Page=Page,this.Auth=Auth,this.user=Auth.getUser()}return _createClass(LogoutController,[{key:"logout",value:function(){this.Auth.logout()}}]),LogoutController}();angular.module("userModule").controller("LogoutController",LogoutController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),RegisterController=function(){function RegisterController(Auth,Page,API,Validate,$scope){var _this=this;_classCallCheck(this,RegisterController),this.Page=Page,this.Auth=Auth,this.API=API,this.Validate=Validate,this.user=Auth.tryGetUser(),this.is_working=0,this.semester=1,this.course=1,$scope.$watch(function(){return _this.username},function(newValue,oldValue){newValue!=oldValue&&(_this.error_no_name=!_this.Validate.nonEmpty(newValue),_this.error_duplicate_name=0)},!0),$scope.$watch(function(){return _this.email},function(newValue,oldValue){newValue!=oldValue&&(_this.error_no_email=!_this.Validate.email(newValue),_this.error_duplicate_email=0)},!0),$scope.$watch(function(){return _this.password},function(newValue,oldValue){newValue!=oldValue&&(_this.error_no_password=!_this.Validate.password(newValue))},!0)}return _createClass(RegisterController,[{key:"register",value:function(){var _this2=this;this.error_duplicate_name=0,
this.error_duplicate_email=0;var validationPassed=1;if(this.username||(validationPassed=0,this.error_no_name=1),this.Validate.email(this.email)||(validationPassed=0,this.error_no_email=1),this.Validate.password(this.password)||(validationPassed=0,this.error_no_password=1),this.password!=this.passwordc&&(validationPassed=0),validationPassed){this.is_working=1;var data={username:this.username,email:this.email.replace("@","(@)"),semester:this.semester,course:this.course,password:this.password};this.API.post("users",data).success(function(result){_this2.is_working=0,"success"==result.status?$("#registerSucessModal").modal("show"):"error_username_taken"==result.status?_this2.error_duplicate_name=1:"error_email_taken"==result.status&&(_this2.error_duplicate_email=1)})}}}]),RegisterController}();angular.module("userModule").controller("RegisterController",RegisterController);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),SettingsController=function(){function SettingsController(Page,Auth,API){_classCallCheck(this,SettingsController),this.API=API,this.Auth=Auth,Page.setTitleAndNav("Einstellungen | Crucio","Name"),this.user=this.Auth.getUser()}return _createClass(SettingsController,[{key:"updateUser",value:function(){var _this=this;this.is_working=!0;var data={highlightExams:this.user.highlightExams,showComments:this.user.showComments,repetitionValue:50,useAnswers:this.user.useAnswers,useTags:this.user.useTags};this.API.put("users/"+this.user.user_id+"/settings",data).success(function(result){"success"==result.status?(_this.Auth.setUser(_this.user),_this.is_saved=!0,_this.is_working=!1):(_this.user=_this.Auth.getUser(),_this.has_error=!0,_this.is_working=!1)})}},{key:"removeAllResults",value:function(){this.API["delete"]("results/"+this.user.user_id)}}]),SettingsController}();angular.module("userModule").controller("SettingsController",SettingsController),angular.module("crucioApp").directive("timeago",function(){var strings={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren",wordSeparator:" ",numbers:[]};return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("timeago",function(){function isFunction(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)}function substitute(stringOrFunction,number){var string=isFunction(stringOrFunction)?stringOrFunction(number,distanceMillis):stringOrFunction,value=strings.numbers&&strings.numbers[number]||number;return string.replace(/%d/i,value)}function trimString(string){return string.replace(/^\s+|\s+$/g,"")}var given=parseInt(attrs.timeago,0),current=(new Date).getTime(),distanceMillis=Math.abs(current-given),seconds=distanceMillis/1e3,minutes=seconds/60,hours=minutes/60,days=hours/24,years=days/365,prefix=strings.prefixAgo,suffix=strings.suffixAgo,words=45>seconds&&substitute(strings.seconds,Math.round(seconds))||90>seconds&&substitute(strings.minute,1)||45>minutes&&substitute(strings.minutes,Math.round(minutes))||90>minutes&&substitute(strings.hour,1)||24>hours&&substitute(strings.hours,Math.round(hours))||42>hours&&substitute(strings.day,1)||30>days&&substitute(strings.days,Math.round(days))||45>days&&substitute(strings.month,1)||365>days&&substitute(strings.months,Math.round(days/30))||1.5>years&&substitute(strings.year,1)||substitute(strings.years,Math.round(years)),separator=strings.wordSeparator,result=trimString([prefix,words,suffix].join(separator));element.text(result)})}}}),angular.module("crucioApp").filter("cut",function(){return function(value,wordwise,max,tail){if(!value)return"";var newMax=parseInt(max,10);if(!newMax)return value;if(value.length<=newMax)return value;var newValue=value.substr(0,newMax);if(wordwise){var lastspace=newValue.lastIndexOf(" ");-1!=lastspace&&(newValue=newValue.substr(0,lastspace))}return newValue+(tail||" ?")}}),angular.module("crucioApp").filter("newlineToBr",function(){return function(text){return angular.isDefined(text)?text.replace(/\n/g,"<br>"):void 0}});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),API=function(){function API($http){_classCallCheck(this,API),this.$http=$http,this.api_base="api/v1/"}return _createClass(API,[{key:"get",value:function(path,data){return this.$http.get(this.api_base+path,{params:data})}},{key:"post",value:function(path,data){return this.$http.post(this.api_base+path,data)}},{key:"put",value:function(path,data){return this.$http.put(this.api_base+path,data)}},{key:"delete",value:function(path,data){return this.$http["delete"](this.api_base+path,{params:data})}}]),API}();angular.module("crucioApp").service("API",API);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Auth=function(){function Auth($cookies,$window){_classCallCheck(this,Auth),this.$window=$window,this.$cookies=$cookies}return _createClass(Auth,[{key:"getUser",value:function(){return this.tryGetUser(),this.user||this.$window.location.replace("/"),this.user}},{key:"tryGetUser",value:function(){return angular.isUndefined(this.user)&&angular.isDefined(this.$cookies.getObject("CrucioUser"))&&this.setUser(this.$cookies.getObject("CrucioUser")),this.user}},{key:"login",value:function(newUser,rememberUser){newUser.remember_user=rememberUser,this.setUser(newUser,!0),this.$window.location.assign("/questions")}},{key:"logout",value:function(){this.$cookies.remove("CrucioUser"),this.$window.location.assign(this.$window.location.origin)}},{key:"setUser",value:function(newUser){var saveNewCookie=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(this.user=newUser,saveNewCookie||angular.isDefined(this.$cookies.getObject("CrucioUser"))){var exp=new Date;exp.setDate(exp.getDate()+21),this.$cookies.putObject("CrucioUser",this.user,{expires:exp})}}}]),Auth}();angular.module("crucioApp").service("Auth",Auth);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Page=function(){function Page(){_classCallCheck(this,Page),this.title="Crucio",this.nav=""}return _createClass(Page,[{key:"setTitle",value:function(newTitle){this.title=newTitle}},{key:"setNav",value:function(newNav){this.nav=newNav}},{key:"setTitleAndNav",value:function(newTitle,newNav){this.title=newTitle,this.nav=newNav}}]),Page}();angular.module("crucioApp").service("Page",Page);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Selection=function(){function Selection(){_classCallCheck(this,Selection)}return _createClass(Selection,[{key:"isElementIncluded",value:function(element,searchDictionary){for(var key in searchDictionary)if("query"==key){var queryString="",_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=searchDictionary.query_keys[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var entry=_step.value;queryString+=element[entry]+" "}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}for(var substringArray=searchDictionary.query.toLowerCase().split(" "),i=0,len=substringArray.length;len>i;++i){var substring=substringArray[i];if(queryString.toLowerCase().indexOf(substring)<0&&substring)return!1}}else if("group"==key){if(searchDictionary.group!=element.group_name&&searchDictionary.group)return!1}else if("query_keys"!=key&&searchDictionary[key]!=element[key]&&searchDictionary[key])return!1;return!0}},{key:"count",value:function(list,searchDictionary){if(!list)return 0;var counter=0,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=list[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var entry=_step2.value;this.isElementIncluded(entry,searchDictionary)&&counter++}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return counter}},{key:"findDistinct",value:function(list,searchKey){var result=[],_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=list[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var entry=_step3.value;-1===result.indexOf(entry[searchKey])&&result.push(entry[searchKey])}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}return result.sort(),result}}]),Selection}();angular.module("crucioApp").service("Selection",Selection);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Validate=function(){function Validate(API){var _this=this;_classCallCheck(this,Validate),this.whitelist=[],API.get("whitelist").success(function(data){_this.whitelist=data.whitelist})}return _createClass(Validate,[{key:"email",value:function(_email){var regex=/[\wäüöÄÜÖ]*@studserv\.uni-leipzig\.de$/;if(0===this.whitelist.length)return!0;if(regex.test(_email))return!0;var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.whitelist[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var entry=_step.value;if(entry.mail_address===_email)return!0}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return!1}},{key:"password",value:function(_password){return _password?_password.length<6?!1:!0:!1}},{key:"nonEmpty",value:function(text){return 0===text.length?!1:!0}}]),Validate}();angular.module("crucioApp").service("Validate",Validate);