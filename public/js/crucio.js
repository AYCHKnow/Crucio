"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function TimeAgo(){var e={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren",wordSeparator:" ",numbers:[]};return{restrict:"A",link:function(t,n,i){i.$observe("timeago",function(){function t(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function s(i,s){var r=t(i)?n(s,l):i,o=e.numbers&&e.numbers[s]||s;return r.replace(/%d/i,o)}function r(e){return e.replace(/^\s+|\s+$/g,"")}var o=parseInt(i.timeago,0),a=(new Date).getTime(),l=Math.abs(a-o),u=l/1e3,c=u/60,h=c/60,m=h/24,d=m/365,f=e.prefixAgo,p=e.suffixAgo,v=45>u&&s(e.seconds,Math.round(u))||90>u&&s(e.minute,1)||45>c&&s(e.minutes,Math.round(c))||90>c&&s(e.hour,1)||24>h&&s(e.hours,Math.round(h))||42>h&&s(e.day,1)||30>m&&s(e.days,Math.round(m))||45>m&&s(e.month,1)||365>m&&s(e.months,Math.round(m/30))||1.5>d&&s(e.year,1)||s(e.years,Math.round(d)),g=r([f,v,p].join(e.wordSeparator));n.text(g)})}}}function Cut(){return function(e,t,n,i){if(!e)return"";var s=parseInt(n,10);if(e.length<=s)return e;var r=e.substr(0,s);if(t){var o=r.lastIndexOf(" ");-1!==o&&(r=r.substr(0,o))}return r+(i||" ?")}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}angular.module("crucioApp",["ngRoute","ngSanitize","ngCookies","ngMessages","ngTagsInput","ui.bootstrap","angular-loading-bar","angularFileUpload","angularSpinner","textAngular","angles","rzModule","duScroll"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/learn",{template:"<learnComponent></learnComponent>"}).when("/author",{template:"<authorComponent></authorComponent>"}).when("/admin",{template:"<adminComponent></adminComponent>"}).when("/global-statistic",{template:"<globalStatisticComponent></globalStatisticComponent>"}).when("/account",{template:"<accountComponent></accountComponent>"}).when("/settings",{template:"<settingsComponent></settingsComponent>"}).when("/edit-exam",{template:"<editExamComponent></editExamComponent>"}).when("/question",{template:"<questionComponent></questionComponent>"}).when("/exam",{template:"<examComponent></examComponent>"}).when("/statistic",{template:"<statisticComponent></statisticComponent>"}).when("/analysis",{template:"<analysisComponent></analysisComponent>"}).when("/help",{template:"<helpComponent></helpComponent>"}).when("/403",{template:"<error403Component></error403Component>"}).when("/404",{template:"<error404Component></error404Component>"}).when("/500",{template:"<error500Component></error500Component>"}).otherwise({redirectTo:"/404"}),t.html5Mode(!0)}]).run(["Auth","$location","$window",function(e,t,n){var i=["/","/register","/forgot-password"],s=["/author","/edit-exam"],r=["/admin","/global-statistic"],o=e.tryGetUser(),a=!1,l=!1,u=!1;o&&(a=Boolean(o.group_id),l=Boolean(2===o.group_id),u=Boolean(3===o.group_id));var c=t.path();i.includes(c)&&a&&o.remember_user&&n.location.replace("/learn"),!s.includes(c)||u||l||n.location.replace("/403"),r.includes(c)&&!l&&n.location.replace("/403")}]);var AboutController=function e(){_classCallCheck(this,e)};angular.module("crucioApp").component("aboutcomponent",{templateUrl:"views/about.html",controller:AboutController});var ActivateController=function t(e,n,i){var s=this;if(_classCallCheck(this,t),this.API=n,this.user=e.tryGetUser(),this.token=i.search().token,this.token){var r={token:this.token};this.API.put("users/activate",r).then(function(e){s.success=e.data.status,s.errorNoToken="error_no_token"===e.data.error,s.errorUnknown="error_unknown"===e.data.error})}else this.success=!1,this.errorNoToken=!0};ActivateController.$inject=["Auth","API","$location"],angular.module("crucioApp").controller("ActivateController",ActivateController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),AdminController=function(){function e(t,n,i,s){var r=this;_classCallCheck(this,e),this.API=i,this.$uibModal=s,t.setTitleAndNav("Verwaltung | Crucio","Admin"),this.activeTab="users",this.user=n.getUser(),this.userSearch={},this.commentSearch={},this.API.get("whitelist").then(function(e){r.whitelist=e.data.whitelist}),this.API.get("stats/summary").then(function(e){r.stats=e.data.stats}),this.API.get("users/distinct").then(function(e){r.distinctGroups=e.data.groups,r.distinctSemesters=e.data.semesters}),this.loadUsers(),this.loadComments()}return e.$inject=["Page","Auth","API","$uibModal"],_createClass(e,[{key:"loadUsers",value:function(){var e=this,t={semester:this.userSearch.semester,group_id:this.userSearch.group,query:this.userSearch.query,limit:100};this.API.get("users",t).then(function(t){e.users=t.data.users})}},{key:"loadComments",value:function(){var e=this,t={query:this.commentSearch.query,limit:50};this.API.get("comments",t).then(function(t){e.comments=t.data.comments,e.questionsByComment=[];var n=!0,i=!1,s=void 0;try{for(var r,o=e.comments[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){for(var a=r.value,l=-1,u=0;u<e.questionsByComment.length;u++)if(e.questionsByComment[u][0].question===a.question){l=u;break}l>-1?e.questionsByComment[l].push(a):e.questionsByComment.push([a])}}catch(c){i=!0,s=c}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}})}},{key:"addMail",value:function(){var e=this.newWhitelistEmail;if(e){this.whitelist.push({mail_address:e,username:""});var t={email:e};this.API.post("whitelist",t)}}},{key:"removeMail",value:function(e){var t=this.whitelist[e].mail_address;t&&(this.whitelist.splice(e,1),this.API["delete"]("whitelist/"+t))}},{key:"changeGroup",value:function(e){var t=this.users[e].user_id,n=this.users[e].group_id;n=n%this.distinctGroups.length+1,this.users[e].group_id=n;var i=!0,s=!1,r=void 0;try{for(var o,a=this.distinctGroups[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;if(l.group_id===n){this.users[e].group_name=l.name;break}}}catch(u){s=!0,r=u}finally{try{!i&&a["return"]&&a["return"]()}finally{if(s)throw r}}var c={group_id:n};this.API.put("users/"+t+"/group",c,!0)}},{key:"isToday",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=new Date,i=n-36e5*t,s=new Date(i),r=new Date(1e3*e);return s.toDateString()===r.toDateString()}},{key:"changeSemester",value:function(e){var t={number:e};this.API.put("users/change-semester",t).then(function(e){alert(e.data.status)})}},{key:"removeTestAccount",value:function(){this.API["delete"]("users/test-account").then(function(e){alert(e.data.status)})}}]),e}();angular.module("crucioApp").component("admincomponent",{templateUrl:"views/admin.html",controller:AdminController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),GlobalStatisticController=function(){function e(t,n,i,s){var r=this;_classCallCheck(this,e),this.API=i,t.setTitleAndNav("Statistik | Crucio","Admin"),this.activeTab="stats",this.user=n.getUser(),this.updateActivity=!1,this.showActivity={result:!1,login:!1,register:!1,comment:!1,examNew:!1,examUpdate:!1},s(function(){r.updateActivity&&r.loadActivity()},2500),this.loadData(),this.loadActivity()}return e.$inject=["Page","Auth","API","$interval"],_createClass(e,[{key:"loadData",value:function(){var e=this;this.API.get("stats/general").then(function(t){e.stats=t.data.stats,e.chart_time_result_today={labels:e.stats.result_dep_time_today_label,datasets:[{label:"Result dep Time",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:e.stats.result_dep_time_today}]}})}},{key:"loadActivity",value:function(){var e=this;this.API.get("stats/activities",this.showActivity,!0).then(function(t){e.activities=t.data.activities})}}]),e}();angular.module("crucioApp").component("globalstatisticcomponent",{templateUrl:"views/global-statistic.html",controller:GlobalStatisticController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),AuthorController=function(){function e(t,n,i,s){var r=this;_classCallCheck(this,e),this.API=i,this.$location=s,t.setTitleAndNav("Autor | Crucio","Autor"),this.activeTab="exams",this.user=n.getUser(),this.examSearch={author:this.user},this.commentSearch={author:this.user},this.API.get("exams/distinct").then(function(e){r.distinctSemesters=e.data.semesters,r.distinctAuthors=e.data.authors,r.distinctSubjects=e.data.subjects}),this.API.get("subjects").then(function(e){r.subjectList=e.data.subjects}),this.loadExams(),this.loadComments()}return e.$inject=["Page","Auth","API","$location"],_createClass(e,[{key:"loadExams",value:function(){var e=this,t={subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,author_id:this.examSearch.author&&this.examSearch.author.user_id,semester:this.examSearch.semester,query:this.examSearch.query,limit:200};this.API.get("exams",t).then(function(t){e.exams=t.data.exams})}},{key:"loadComments",value:function(){var e=this,t={author_id:this.commentSearch.author&&this.commentSearch.author.user_id,query:this.commentSearch.query,limit:100};this.API.get("comments/author",t).then(function(t){e.comments=t.data.comments,e.questionsByComment=[];var n=!0,i=!1,s=void 0;try{for(var r,o=e.comments[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){for(var a=r.value,l=-1,u=0;u<e.questionsByComment.length;u++)if(e.questionsByComment[u][0].question===a.question){l=u;break}l>0?e.questionsByComment[l].push(a):e.questionsByComment.push([a])}}catch(c){i=!0,s=c}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}e.questionsByComment.sort(function(e,t){return t[0].date-e[0].date})})}},{key:"newExam",value:function(){var e=this,t={subject_id:1,user_id_added:this.user.user_id};this.API.post("exams",t).then(function(t){e.$location.path("/edit-exam").search("id",t.data.exam_id)})}}]),e}();angular.module("crucioApp").component("authorcomponent",{templateUrl:"views/author.html",controller:AuthorController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),EditExamController=function(){function e(t,n,i,s,r,o,a){var l=this;_classCallCheck(this,e),this.API=i,this.FileUploader=s,this.$location=o,t.setTitleAndNav("Klausur | Crucio","Autor"),this.user=n.getUser(),this.examId=a.id,this.openQuestionId=a.question_id,this.openQuestionIndex=-1,this.numberChanged=0,this.uploader=new s({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(e,t){l.exam.file_name=t.upload_name},this.uploaderArray=[],r.$watch(function(){return l.exam},function(){l.hasChanged=l.numberChanged>1,l.numberChanged+=1},!0),r.$on("$locationChangeStart",function(e){if(l.hasChanged){var t=confirm("Die Änderungen an der Klausur bleiben dann ungespeichert. Wirklich verlassen?");t||e.preventDefault()}}),this.API.get("subjects").then(function(e){l.subjectList=e.data.subjects}),this.loadExam()}return e.$inject=["Page","Auth","API","FileUploader","$scope","$location","$routeParams"],_createClass(e,[{key:"loadExam",value:function(){var e=this;this.API.get("exams/"+this.examId).then(function(t){e.exam=t.data.exam,e.questions=t.data.questions;for(var n=0;n<e.questions.length;n++)e.questions[n].question_id===e.openQuestionId&&(e.openQuestionIndex=n);e.remakeUploaderArray(),0===e.questions.length&&e.addQuestion(!1),e.ready=!0})}},{key:"getCategories",value:function(e){var t=!0,n=!1,i=void 0;try{for(var s,r=this.subjectList[Symbol.iterator]();!(t=(s=r.next()).done);t=!0){var o=s.value;if(o.subject_id===e)return o.categories}}catch(a){n=!0,i=a}finally{try{!t&&r["return"]&&r["return"]()}finally{if(n)throw i}}return-1}},{key:"remakeUploaderArray",value:function(){var e=this;this.uploaderArray=[];for(var t=0;t<this.questions.length;t++){var n=new this.FileUploader({url:"/api/v1/file/upload",formData:t});n.onSuccessItem=function(t,n){var i=t.formData;e.questions[i].question_image_url=n.upload_name},this.uploaderArray.push(n)}}},{key:"addQuestion",value:function(e){var t={category_id:0,question:"",type:5,correct_answer:0,answers:["","","","","",""]};this.questions.push(t),e&&(this.openQuestionIndex=this.questions.length-1),this.remakeUploaderArray()}},{key:"deleteQuestion",value:function(e){var t=this.questions[e].question_id;t&&this.API["delete"]("questions/"+t),this.questions.splice(e,1),this.openQuestionIndex=Math.min(this.openQuestionIndex,this.questions.length-1),this.remakeUploaderArray(),this.questions||this.addQuestion(1)}},{key:"saveExam",value:function(){var e=this,t=this.exam.subject_id&&this.exam.semester>0&&this.exam.semester<=50&&this.exam.date;if(t){this.isSaving=!0,this.API.put("exams/"+this.examId,this.exam);var n=!0,i=!1,s=void 0;try{for(var r,o=function(){var t=r.value,n=t.question||t.question_id;if(n){t.explanation=t.explanation||"",t.question_image_url=t.question_image_url||"";var i={exam_id:e.exam.exam_id,user_id_added:e.user.user_id,category_id:t.category_id,question:t.question,type:t.type,answers:t.answers,correct_answer:t.correct_answer,explanation:t.explanation,question_image_url:t.question_image_url};t.question_id?e.API.put("questions/"+t.question_id,i):e.API.post("questions",i).then(function(e){t.question_id=e.data.question_id})}},a=this.questions[Symbol.iterator]();!(n=(r=a.next()).done);n=!0)o()}catch(l){i=!0,s=l}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw s}}this.hasChanged=!1,this.isSaving=!1}else alert("Es fehlen noch allgemeine Infos zur Klausur.")}},{key:"deleteExam",value:function(){var e=this;this.API["delete"]("exams/"+this.exam.exam_id).then(function(){e.$location.url("/author")})}}]),e}();angular.module("crucioApp").component("editexamcomponent",{templateUrl:"views/edit-exam.html",controller:EditExamController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ContactController=function(){function e(t,n,i,s){_classCallCheck(this,e),this.API=n,this.$uibModal=s,this.user=t.tryGetUser(),this.user&&(this.name=this.user.username,this.email=this.user.email)}return e.$inject=["Auth","API","$location","$uibModal"],_createClass(e,[{key:"sendMail",value:function(){var e=this;this.isWorking=!0;var t={text:this.text,name:this.name,email:this.email};this.API.post("contact/send-mail",t).then(function(t){t.data.status&&e.$uibModal.open({templateUrl:"myModalContent.html"}),e.emailSend=t.data.status,e.isWorking=!1})}}]),e}();angular.module("crucioApp").controller("ContactController",ContactController);var ErrorController=function n(e){_classCallCheck(this,n),e.setTitleAndNav("Fehler | Crucio","")};ErrorController.$inject=["Page"],angular.module("crucioApp").component("error403component",{templateUrl:"views/403.html",controller:ErrorController}),angular.module("crucioApp").component("error404component",{templateUrl:"views/404.html",controller:ErrorController}),angular.module("crucioApp").component("error500component",{templateUrl:"views/500.html",controller:ErrorController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ForgotPasswordController=function(){function e(t,n,i,s){var r=this;if(_classCallCheck(this,e),this.API=t,this.$scope=i,this.$uibModal=s,this.confirm=n.search().confirm,this.deny=n.search().deny,this.reset=!this.confirm&&!this.deny,this.confirm){this.reset=!1;var o={token:this.confirm};this.API.put("users/password/confirm",o).then(function(e){r.status=e.data.status,r.$uibModal.open({templateUrl:"forgotConfirmModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{data:function(){return r.status}}})})}if(this.deny){this.reset=!1;var a={token:this.deny};t.put("users/password/deny",a).then(function(e){r.status=e.data.status,r.$uibModal.open({templateUrl:"forgotDenyModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{data:function(){return r.status}}})})}}return e.$inject=["API","$location","$scope","$uibModal"],_createClass(e,[{key:"resetPassword",value:function(){var e=this;this.$scope.form.email.$setValidity("already",!0),this.isWorking=!0;var t={email:this.email};this.API.put("users/password/reset",t).then(function(t){t.data.status&&e.$uibModal.open({templateUrl:"forgotSucessModalContent.html"}),e.$scope.form.email.$setValidity("already","error_already_requested"!==t.data.error),e.isWorking=!0})}}]),e}();angular.module("crucioApp").controller("ForgotPasswordController",ForgotPasswordController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),HelpController=function(){function e(t,n,i,s){var r=this;_classCallCheck(this,e),this.API=i,n.setTitleAndNav("Hilfe | Crucio",""),this.user=t.getUser(),this.question_id=s.search().question_id,this.subject=s.search().s,this.question_id&&this.API.get("questions/"+this.question_id).then(function(e){r.question=e.data.question})}return e.$inject=["Auth","Page","API","$location"],_createClass(e,[{key:"sendMail",value:function(){var e=this,t=this.text;if(t)if(this.isWorking=!0,this.question_id){var n={text:this.text,name:this.user.username,email:this.user.email,question_id:this.question_id,author:this.question.username,question:this.question.question,exam_id:this.question.exam_id,subject:this.question.subject,date:this.question.date,author_email:this.question.email,mail_subject:this.subject};this.API.post("contact/send-mail-question",n).then(function(){e.isWorking=!1,e.emailSend=!0})}else{var i={text:this.text,name:this.user.username,email:this.user.email};this.API.post("contact/send-mail",i).then(function(){e.isWorking=!1,e.emailSend=!0})}}}]),e}();angular.module("crucioApp").component("helpcomponent",{templateUrl:"views/help.html",controller:HelpController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),AnalysisController=function(){function e(t,n,i,s){function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}var o=this;_classCallCheck(this,e),this.API=i,t.setTitleAndNav("Analyse | Crucio","Lernen"),this.user=n.getUser();var a=!0,l=!1,u=void 0;try{for(var c,h=this.Collection.get().list[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){var m=c.value;if(!m.mark_answer&&m.type>1&&m.given_result>0){var d=m.correct_answer===m.given_result?1:0;0!==m.correct_answer&&1!==m.question.type||(d=-1);var f={correct:d,given_result:m.given_result,question_id:m.question_id,user_id:this.user.user_id};this.API.post("results",f)}}}catch(p){l=!0,u=p}finally{try{!a&&h["return"]&&h["return"]()}finally{if(l)throw u}}this.random=r(0,1e3),this.examId=this.Collection.get().exam_id,this.workedCollection=s.getWorked(),this.count=s.analyseCount(),this.examId&&this.API.get("exams/"+this.examId).then(function(e){o.exam=e.data.exam})}return e.$inject=["Page","Auth","API","Collection"],_createClass(e,[{key:"showCorrectAnswerClicked",value:function(e){this.workedCollection[e].show_correct_answer=1}}]),e}();angular.module("crucioApp").component("analysiscomponent",{templateUrl:"views/analysis.html",controller:AnalysisController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ExamController=function(){function e(t,n,i,s,r,o,a,l,u,c){var h=this;_classCallCheck(this,e),this.API=i,this.Collection=s,this.$location=r,this.$document=u,this.$uibModal=o,t.setTitleAndNav("Klausur | Crucio","Lernen"),this.user=n.getUser(),this.examId=a.id,this.currentIndex=0,u.on("scroll",function(){for(var e=u.scrollTop(),t=function(t){var n=angular.element(c.document.getElementById("id"+t));return n.prop("offsetTop")>e?(l(function(){h.currentIndex=Math.max(t-1,0)},0),!0):!1},n=0;n<h.Collection.get().list.length&&!t(n);n++);}),this.loadExam()}return e.$inject=["Page","Auth","API","Collection","$location","$uibModal","$routeParams","$timeout","$document","$window"],_createClass(e,[{key:"loadExam",value:function(){var e=this;this.API.get("exams/"+this.examId).then(function(t){e.exam=t.data.exam,e.length=t.data.questions.length,e.Collection.set({type:"exam",exam_id:e.examId,list:t.data.questions})})}},{key:"isHalftime",value:function(e){return Math.abs(e+1-this.questions.length/2)<1&&e>3}},{key:"handExam",value:function(){this.$location.path("/analysis").search("id",null)}},{key:"openImageModal",value:function(e){this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{data:function(){return e}}})}}]),e}();angular.module("crucioApp").component("examcomponent",{templateUrl:"views/exam.html",controller:ExamController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),LearnController=function(){function e(t,n,i,s,r,o,a){var l=this;_classCallCheck(this,e),this.API=i,this.Collection=s,this.$location=o,n.setTitleAndNav("Lernen | Crucio","Lernen"),this.activeTab="abstract",this.user=t.getUser(),this.examSearch={semester:this.user.semester},this.commentSearch={},this.questionSearch={},this.selection={},this.selectedQuestionNumber=0,this.numberQuestionsInSelection=0,this.sliderOptions={floor:0,ceil:this.numberQuestionsInSelection},a(function(){r.$broadcast("rzSliderForceRender")}),this.API.get("exams/distinct").then(function(e){l.distinctSemesters=e.data.semesters,l.distinctSubjects=e.data.subjects}),this.API.get("subjects").then(function(e){l.subjectList=e.data.subjects}),this.loadAbstract(),this.loadExams(),this.loadTags(),this.loadComments()}return e.$inject=["Auth","Page","API","Collection","$scope","$location","$timeout"],_createClass(e,[{key:"loadAbstract",value:function(){var e=this,t={limit:12};this.API.get("exams/abstract/"+this.user.user_id,t).then(function(t){e.abstractExams=t.data.exams,e.ready=1})}},{key:"loadExams",value:function(){var e=this,t={user_id:this.user.user_id,semester:this.examSearch.semester,subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,query:this.examSearch.query,visibility:1};this.API.get("exams",t).then(function(t){e.exams=t.data.exams})}},{key:"loadTags",value:function(){var e=this,t={user_id:this.user.user_id};this.API.get("tags",t).then(function(t){e.tags=t.data.tags,e.distinctTags=[];var n=!0,i=!1,s=void 0;try{for(var r,o=e.tags[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value,l=!0,u=!1,c=void 0;try{for(var h,m=a.tags.split(",")[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var d=h.value;e.distinctTags.includes(d)||e.distinctTags.push(d)}}catch(f){u=!0,c=f}finally{try{!l&&m["return"]&&m["return"]()}finally{if(u)throw c}}}}catch(f){i=!0,s=f}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}e.questionsByTag={};var p=!0,v=!1,g=void 0;try{for(var C,y=e.distinctTags[Symbol.iterator]();!(p=(C=y.next()).done);p=!0){var w=C.value;e.questionsByTag[w]=[];var _=!0,A=!1,b=void 0;try{for(var k,x=e.tags[Symbol.iterator]();!(_=(k=x.next()).done);_=!0){var q=k.value,I=!0,P=!1,$=void 0;try{for(var S,j=q.tags.split(",")[Symbol.iterator]();!(I=(S=j.next()).done);I=!0){var T=S.value;w===T&&e.questionsByTag[w].push(q)}}catch(f){P=!0,$=f}finally{try{!I&&j["return"]&&j["return"]()}finally{if(P)throw $}}}}catch(f){A=!0,b=f}finally{try{!_&&x["return"]&&x["return"]()}finally{if(A)throw b}}}}catch(f){v=!0,g=f}finally{try{!p&&y["return"]&&y["return"]()}finally{if(v)throw g}}})}},{key:"loadComments",value:function(){var e=this,t={query:this.commentSearch.query,user_id:this.user.user_id};this.API.get("comments",t).then(function(t){e.comments=t.data.comments,e.questionsByComment={};var n=!0,i=!1,s=void 0;try{for(var r,o=e.comments[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;e.questionsByComment[a.question]=e.questionsByComment[a.question]||[],e.questionsByComment[a.question].push(a)}}catch(l){i=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}})}},{key:"loadNumberQuestions",value:function(){var e=this,t={selection:this.selection};this.API.get("questions/count",t,!0).then(function(t){e.numberQuestionsInSelection=t.data.count;var n=Math.min(e.numberQuestionsInSelection,500);e.sliderOptions={floor:0,ceil:n},e.selectedQuestionNumber||(e.selectedQuestionNumber=50),e.selectedQuestionNumber=Math.min(e.selectedQuestionNumber,e.numberQuestionsInSelection)})}},{key:"searchQuestion",value:function(){var e=this;if(this.searchResults=[],this.hasSearched=!1,this.questionSearch.query){this.showSpinner=!0;var t={query:this.questionSearch.query,subject_id:this.questionSearch.subject&&this.questionSearch.subject.subject_id,semester:this.questionSearch.semester,visibility:1,limit:100};this.API.get("questions",t,!0).then(function(t){e.searchResults=t.data.result,e.showSpinner=!1,e.hasSearched=!0})}}},{key:"learnExam",value:function(e){var t=this,n={random:!0};this.Collection.prepareExam(e,n).then(function(e){t.$location.path("/question").search("id",e.list[0].question_id)})}},{key:"learnSubjects",value:function(){var e=this,t={selection:this.selection,limit:this.selectedQuestionNumber};this.Collection.prepareSubjects(t).then(function(t){e.$location.path("/question").search("id",t.list[0].question_id)})}},{key:"resetExam",value:function(e){e.answered_questions=0,this.API["delete"]("results/"+this.user.user_id+"/"+e.exam_id,!0)}}]),e}();angular.module("crucioApp").component("learncomponent",{templateUrl:"views/learn.html",controller:LearnController});var ModalInstanceController=function i(e,t){_classCallCheck(this,i),this.data=e,this.$modalInstance=t};ModalInstanceController.$inject=["data","$modalInstance"],angular.module("crucioApp").controller("ModalInstanceController",ModalInstanceController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),QuestionController=function(){function e(t,n,i,s,r,o,a){if(_classCallCheck(this,e),this.Auth=t,this.API=i,this.Collection=s,this.$uibModal=a,n.setTitleAndNav("Frage | Crucio","Lernen"),this.user=t.getUser(),this.questionId=Number(r.id),this.resetSession=Boolean(r.reset_session),this.commentsCollapsed=Boolean(this.user.showComments),this.questionId||this.$window.location.replace("/questions"),this.noAnswer=!0,this.showExplanation=!1,this.collection=this.Collection.get(),this.resetSession&&(delete this.collection,s.remove()),this.index=this.Collection.getIndexOfQuestion(this.questionId),-1!==this.index){var l=this.collection.list;this.questionData=this.Collection.getQuestionData(this.index),this.length=l.length,this.preQuestionId=this.index>0?l[this.index-1].question_id:-1,this.postQuestionId=this.index<this.length?l[this.index+1].question_id:-1}this.loadQuestion()}return e.$inject=["Auth","Page","API","Collection","$routeParams","$window","$uibModal"],_createClass(e,[{key:"loadQuestion",value:function(){var e=this;this.API.get("questions/"+this.questionId+"/user/"+this.user.user_id).then(function(t){e.question=t.data.question,e.comments=t.data.comments,e.tags=[],t.data.tags&&(e.tags=t.tags.split(",").map(function(e){return{text:e}})),e.checkedAnswer=e.questionData.givenAnswer,e.questionData.showAnswer&&e.markAnswer(e.questionData.givenAnswer)})}},{key:"updateTags",value:function(){var e=this.tags.map(function(e){return e.text}).join(","),t={tags:e,question_id:this.questionId,user_id:this.user.user_id};this.API.post("tags",t,!0)}},{key:"showSolution",value:function(){var e=this.question.correct_answer;this.checkedAnswer=e;var t=e===this.questionData.givenAnswer?1:0;0!==e&&1!==this.question.type||(t=-1);var n={correct:t,question_id:this.questionId,
user_id:this.user.user_id,given_result:this.questionData.givenAnswer};this.API.post("results",n,!0),this.Collection.saveMarkAnswer(this.index),this.markAnswer(this.questionData.givenAnswer)}},{key:"saveAnswer",value:function(e){this.questionData.givenAnswer=e,this.Collection.saveAnswer(this.index,this.questionData.givenAnswer)}},{key:"markAnswer",value:function(e){this.isAnswerGiven=!0;var t=this.question.type;t>1&&(this.correctAnswer=this.question.correct_answer,this.checkedAnswer=e>0?e:this.correctAnswer,this.isAnswerRight=e===this.correctAnswer,this.isAnswerWrong=e!==this.correctAnswer,e!==this.correctAnswer&&(this.wrongAnswer=e))}},{key:"addComment",value:function(){var e=this,t=new Date/1e3,n={comment:this.commentText,question_id:this.questionId,reply_to:0,username:this.user.username,date:t};this.API.post("comments/"+this.user.user_id,n).then(function(t){n.voting=0,n.user_voting=0,n.comment_id=t.data.comment_id,e.comments.push(n),e.commentText=""})}},{key:"deleteComment",value:function(e){var t=this.comments[e].comment_id;this.API["delete"]("comments/"+t),this.comments.splice(e,1)}},{key:"changeUserVoting",value:function(e,t){e.user_voting=Math.min(Math.max(e.user_voting+t,-1),1);var n={user_voting:e.user_voting};this.API.post("comments/"+e.comment_id+"/user/"+this.user.user_id,n,!0)}},{key:"openImageModal",value:function(){var e=this;this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"ctrl",resolve:{data:function(){return e.question.question_image_url}}})}}]),e}();angular.module("crucioApp").component("questioncomponent",{templateUrl:"views/question.html",controller:QuestionController});var StatisticController=function s(e,t){_classCallCheck(this,s),t.setTitleAndNav("Statistik | Crucio","Lernen"),this.user=e.getUser()};StatisticController.$inject=["Auth","Page"],angular.module("crucioApp").component("statisticcomponent",{templateUrl:"views/statistic.html",controller:StatisticController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),LoginController=function(){function e(t,n,i){_classCallCheck(this,e),this.Auth=t,this.API=n,this.$document=i,this.user=this.Auth.tryGetUser(),this.rememberMe=!0}return e.$inject=["Auth","API","$document"],_createClass(e,[{key:"formChanged",value:function(){this.loginError=!1}},{key:"login",value:function(){var e=this,t={email:this.email,remember_me:this.rememberMe,password:this.password};this.API.get("users/login",t).then(function(t){e.loginError=!t.data.status,e.loginError||e.Auth.login(t.data.logged_in_user,e.rememberMe)})}}]),e}();angular.module("crucioApp").controller("LoginController",LoginController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),LogoutController=function(){function e(t,n){_classCallCheck(this,e),this.Page=n,this.Auth=t,this.user=t.getUser()}return e.$inject=["Auth","Page"],_createClass(e,[{key:"logout",value:function(){this.Auth.logout()}}]),e}();angular.module("crucioApp").controller("LogoutController",LogoutController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),RegisterController=function(){function e(t,n,i,s){_classCallCheck(this,e),this.API=n,this.$scope=i,this.$uibModal=s,this.user=t.tryGetUser(),this.semester=1,this.course=1}return e.$inject=["Auth","API","$scope","$uibModal"],_createClass(e,[{key:"formChanged",value:function(){var e=/[\wäüöÄÜÖ]*@studserv\.uni-leipzig\.de$/;this.$scope.form.email.$setValidity("studserv",e.test(this.email)),this.$scope.form.passwordc.$setValidity("confirm",this.password===this.passwordc)}},{key:"register",value:function(){var e=this;this.$scope.form.username.$setValidity("duplicate",!0),this.$scope.form.email.$setValidity("duplicate",!0),this.isWorking=!0;var t={username:this.username,email:this.email,semester:this.semester,course:this.course,password:this.password};this.API.post("users",t,!0).then(function(t){t.data.status&&e.$uibModal.open({templateUrl:"registerModalContent.html"}),e.isWorking=!1,e.$scope.form.username.$setValidity("duplicate","error_username_taken"!==t.data.error),e.$scope.form.email.$setValidity("duplicate","error_email_taken"!==t.data.error)})}}]),e}();angular.module("crucioApp").controller("RegisterController",RegisterController);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),AccountController=function(){function e(t,n,i,s){_classCallCheck(this,e),this.API=i,this.Auth=n,this.$scope=s,t.setTitleAndNav("Account | Crucio","Name"),this.user=this.Auth.getUser()}return e.$inject=["Page","Auth","API","$scope"],_createClass(e,[{key:"formChanged",value:function(){this.$scope.form.passwordc.$setValidity("confirm",this.password===this.passwordc)}},{key:"saveUser",value:function(){var e=this;this.isSaved=!1,this.hasError=!1,this.isWorking=!0;var t={email:this.user.email,course_id:this.user.course_id,semester:this.user.semester,current_password:this.oldPassword,password:this.newPassword};this.API.put("users/"+this.user.user_id+"/account",t,!0).then(function(t){t.data.status?e.Auth.setUser(e.user):(e.user=e.Auth.getUser(),e.hasError=!0),e.isSaved=t.data.status,e.wrongPassword="error_incorrect_password"===t.data.error,e.isWorking=!1})}}]),e}();angular.module("crucioApp").component("accountcomponent",{templateUrl:"views/account.html",controller:AccountController});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),SettingsController=function(){function e(t,n,i){_classCallCheck(this,e),this.API=i,this.Auth=n,t.setTitleAndNav("Einstellungen | Crucio","Name"),this.user=this.Auth.getUser()}return e.$inject=["Page","Auth","API"],_createClass(e,[{key:"formChanged",value:function(){this.isSaved=!1,this.hasError=!1}},{key:"updateUser",value:function(){var e=this;this.formChanged(),this.isWorking=!0;var t={highlightExams:this.user.highlightExams,showComments:this.user.showComments,repetitionValue:50,useAnswers:this.user.useAnswers,useTags:this.user.useTags};this.API.put("users/"+this.user.user_id+"/settings",t,!0).then(function(t){t.data.status?e.Auth.setUser(e.user):(e.user=e.Auth.getUser(),e.hasError=!0),e.isSaved=t.data.status,e.isWorking=!1})}},{key:"removeAllResults",value:function(){this.API["delete"]("results/"+this.user.user_id)}}]),e}();angular.module("crucioApp").component("settingscomponent",{templateUrl:"views/settings.html",controller:SettingsController}),angular.module("crucioApp").directive("timeago",TimeAgo),angular.module("crucioApp").filter("cut",Cut);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),API=function(){function e(t){_classCallCheck(this,e),this.$http=t,this.base="api/v1/"}return e.$inject=["$http"],_createClass(e,[{key:"sanitize",value:function(e){return e.email=e.email&&e.email.replace("@","(@)"),e}},{key:"get",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return this.$http.get(this.base+e,{ignoreLoadingBar:n,params:this.sanitize(t)})}},{key:"post",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return this.$http.post(this.base+e,this.sanitize(t),{ignoreLoadingBar:n})}},{key:"put",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return this.$http.put(this.base+e,this.sanitize(t),{ignoreLoadingBar:n})}},{key:"delete",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return this.$http["delete"](this.base+e,{ignoreLoadingBar:n,params:this.sanitize(t)})}}]),e}();angular.module("crucioApp").service("API",API);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Auth=function(){function e(t,n){_classCallCheck(this,e),this.$window=n,this.$cookies=t}return e.$inject=["$cookies","$window"],_createClass(e,[{key:"getUser",value:function(){return this.tryGetUser(),this.user||this.$window.location.replace("/"),this.user}},{key:"tryGetUser",value:function(){return angular.isUndefined(this.user)&&angular.isDefined(this.$cookies.getObject("CrucioUser"))&&this.setUser(this.$cookies.getObject("CrucioUser")),this.user}},{key:"login",value:function(e,t){e.remember_user=t,this.setUser(e,!0),this.$window.location.assign("/learn")}},{key:"logout",value:function(){this.$cookies.remove("CrucioUser"),this.$window.location.assign(this.$window.location.origin)}},{key:"setUser",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(this.user=e,t||angular.isDefined(this.$cookies.getObject("CrucioUser"))){var n=new Date;n.setDate(n.getDate()+21),this.$cookies.putObject("CrucioUser",this.user,{expires:n})}}}]),e}();angular.module("crucioApp").service("Auth",Auth);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Collection=function(){function e(t){_classCallCheck(this,e),this.API=t}return e.$inject=["API"],_createClass(e,[{key:"get",value:function(){return angular.isUndefined(this.collection)&&angular.isDefined(sessionStorage.crucioCollection)&&this.set(angular.fromJson(sessionStorage.crucioCollection)),this.collection}},{key:"set",value:function(e){this.collection=e,sessionStorage.crucioCollection=angular.toJson(e)}},{key:"remove",value:function(){delete this.collection,sessionStorage.removeItem("crucioCollection")}},{key:"getWorked",value:function(){return this.get(),this.collection.list.filter(function(e){return e.given_result})}},{key:"analyseCount",value:function(){var e=this.getWorked(),t={correct:0,wrong:0,seen:0,solved:0,free:0,no_answer:0,all:this.collection.list.length,worked:e.length},n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;a.correct_answer===a.given_result&&a.given_result>0&&a.correct_answer>0&&t.correct++,a.correct_answer!==a.given_result&&a.given_result>0&&a.correct_answer>0&&t.wrong++,a.given_result>0&&t.solved++,a.given_result>-2&&t.seen++,1===a.type&&t.free++,0===a.correct_answer&&1!==a.type&&t.no_answer++}}catch(l){i=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(i)throw s}}return t}},{key:"saveAnswer",value:function(e,t){this.collection&&Object.keys(this.collection).length&&(this.collection.list[e].given_result=t,this.set(this.collection))}},{key:"saveStrike",value:function(e,t){this.collection&&Object.keys(this.collection).length&&(this.collection.list[e].strike=t,this.set(this.collection))}},{key:"saveMarkAnswer",value:function(e){this.collection&&Object.keys(this.collection).length&&(this.collection.list[e].mark_answer=1,this.set(this.collection))}},{key:"prepareExam",value:function(e,t){var n=this;return this.API.get("exams/action/prepare/"+e,t).then(function(t){var i={list:t.data.list,exam_id:e};return n.set(i),i})}},{key:"prepareSubjects",value:function(e){var t=this;return this.API.get("questions/prepare-subjects",e).then(function(n){var i={list:n.data.list,selection:e.selection};return t.Collection.set(i),i})}},{key:"getIndexOfQuestion",value:function(e){for(var t=0;t<this.collection.list.length;t++)if(this.collection.list[t].question_id===e)return t;return-1}},{key:"getQuestionData",value:function(e){return this.collection.list[e]}}]),e}();angular.module("crucioApp").service("Collection",Collection);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Page=function(){function e(t){_classCallCheck(this,e),this.$window=t}return e.$inject=["$window"],_createClass(e,[{key:"setTitle",value:function(e){this.title=e}},{key:"setNav",value:function(e){this.nav=e}},{key:"setTitleAndNav",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"":arguments[1];this.title=e,this.nav=t,this.$window.document.title=this.title}}]),e}();angular.module("crucioApp").service("Page",Page);var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Validate=function(){function e(t){var n=this;_classCallCheck(this,e),this.API=t,t.get("whitelist",{},!0).then(function(e){n.whitelist=e.data.whitelist})}return e.$inject=["API"],_createClass(e,[{key:"username",value:function(e){return e.length>4}},{key:"email",value:function(e){var t=/[\wäüöÄÜÖ]*@studserv\.uni-leipzig\.de$/;return t.test(e)?!0:this.whitelist&&this.whitelist.some(function(t){return t.mail_address===e})}},{key:"password",value:function(e){return e&&e.length>4}}]),e}();angular.module("crucioApp").service("Validate",Validate);