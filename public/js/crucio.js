var __assign=this&&this.__assign||Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++){e=arguments[o];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};angular.module("crucioApp",["ngCookies","ngMessages","ngTagsInput","ui.router","ui.bootstrap","angularFileUpload","angularSpinner","textAngular","rzModule","duScroll"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$provide",function(t,e,o,n){function i(t){return"<"+t+"Component></"+t+"Component>"}var s=[{name:"learn",url:"/learn",template:i("learn")},{name:"learn.overview",url:"/overview",template:i("learnoverview")},{name:"learn.subjects",url:"/subjects",template:i("learnsubjects")},{name:"learn.exams",url:"/exams",template:i("learnexams")},{name:"learn.search",url:"/search",template:i("learnsearch")},{name:"learn.tags",url:"/tags",template:i("learntags")},{name:"learn.comments",url:"/comments",template:i("learncomments")},{name:"learn.oral-exams",url:"/oral-exams",template:i("learnoralexams")},{name:"question",url:"/question?questionId&resetSession",template:i("question")},{name:"exam",url:"/exam?examId",template:i("exam")},{name:"statistic",url:"/statistic",template:i("statistic")},{name:"analysis",url:"/analysis",template:i("analysis")},{name:"author",url:"/author",template:i("author")},{name:"author.exams",url:"/exams",template:i("authorexams")},{name:"author.comments",url:"/comments",template:i("authorcomments")},{name:"author.subjects",url:"/subjects",template:i("authorsubjects")},{name:"author.oral-exams",url:"/oral-exams",template:i("authororalexams")},{name:"author.advices",url:"/advices",template:i("authoradvices")},{name:"edit-exam",url:"/edit-exam?examId&questionId",template:i("editExam")},{name:"edit-oral-exam",url:"/edit-oral-exam?oralExamId",template:i("editOralExam")},{name:"admin",url:"/admin",template:i("admin")},{name:"admin.users",url:"/users",template:i("adminusers")},{name:"admin.whitelist",url:"/whitelist",template:i("adminwhitelist")},{name:"admin.tools",url:"/tools",template:i("admintools")},{name:"admin.stats",url:"/stats",template:i("adminstats")},{name:"admin.activity",url:"/activity",template:i("adminactivity")},{name:"user",url:"/user",template:i("user")},{name:"403",url:"/403",template:i("error403")},{name:"404",url:"/404",template:i("error404")},{name:"500",url:"/500",template:i("error500")},{name:"help",url:"/help",template:i("help")}];e.otherwise("/404"),o.html5Mode(!0),s.forEach(function(e){t.state(e)}),n.decorator("taOptions",["taRegisterTool","$delegate",function(t,e){return t("times",{buttontext:"&times;",tooltiptext:"times",action:function(){return this.$editor().wrapSelection("inserthtml","&times;")}}),t("arrow-left",{buttontext:"&larr;",tooltiptext:"arrow-left",action:function(){return this.$editor().wrapSelection("inserthtml","&larr;")}}),t("arrow-right",{buttontext:"&rarr;",tooltiptext:"arrow-right",action:function(){return this.$editor().wrapSelection("inserthtml","&rarr;")}}),t("arrow-left-right",{buttontext:"&harr;",tooltiptext:"arrow-left-right",action:function(){return this.$editor().wrapSelection("inserthtml","&harr;")}}),t("sdot",{buttontext:"&sdot;",tooltiptext:"sdot",action:function(){return this.$editor().wrapSelection("inserthtml","&sdot;")}}),t("asymp",{buttontext:"&asymp;",tooltiptext:"asymp",action:function(){return this.$editor().wrapSelection("inserthtml","&asymp;")}}),t("radic",{buttontext:"&radic;",tooltiptext:"radic",action:function(){return this.$editor().wrapSelection("inserthtml","&radic;")}}),t("prop",{buttontext:"&prop;",tooltiptext:"prop",action:function(){return this.$editor().wrapSelection("inserthtml","&prop;")}}),t("alpha",{buttontext:"&alpha;",tooltiptext:"alpha",action:function(){return this.$editor().wrapSelection("inserthtml","&alpha;")}}),t("beta",{buttontext:"&beta;",tooltiptext:"beta",action:function(){return this.$editor().wrapSelection("inserthtml","&beta;")}}),t("gamma",{buttontext:"&gamma;",tooltiptext:"gamma",action:function(){return this.$editor().wrapSelection("inserthtml","&gamma;")}}),t("delta",{buttontext:"&delta;",tooltiptext:"delta",action:function(){return this.$editor().wrapSelection("inserthtml","&delta;")}}),t("lambda",{buttontext:"&lambda;",tooltiptext:"lambda",action:function(){return this.$editor().wrapSelection("inserthtml","&lambda;")}}),t("mu",{buttontext:"&mu;",tooltiptext:"mu",action:function(){return this.$editor().wrapSelection("inserthtml","&mu;")}}),t("pi",{buttontext:"&pi;",tooltiptext:"pi",action:function(){return this.$editor().wrapSelection("inserthtml","&pi;")}}),t("rho",{buttontext:"&rho;",tooltiptext:"rho",action:function(){return this.$editor().wrapSelection("inserthtml","&rho;")}}),t("omega",{buttontext:"&omega;",tooltiptext:"omega",action:function(){return this.$editor().wrapSelection("inserthtml","&omega;")}}),t("Omega",{buttontext:"&Omega;",tooltiptext:"Omega",action:function(){return this.$editor().wrapSelection("inserthtml","&Omega;")}}),t("subscript",{iconclass:"fa fa-subscript",tooltiptext:"Subscript",action:function(){return this.$editor().wrapSelection("subscript",null)},activeState:function(){return this.$editor().queryCommandState("subscript")}}),t("superscript",{iconclass:"fa fa-superscript",tooltiptext:"Superscript",action:function(){return this.$editor().wrapSelection("superscript",null)},activeState:function(){return this.$editor().queryCommandState("superscript")}}),e}])}]).run(["Auth","$location","$window",function(t,e,o){var n=["/","/register","/forgot-password"],i=["/author","/edit-exam","/edit-oral-exam"],s=["/admin"],r=t.tryGetUser(),a=!1,u=!1,l=!1;r&&(a=Boolean(r.group_id),u=Boolean(2===r.group_id),l=Boolean(3===r.group_id));var c=e.path();n.indexOf(c)>-1&&a&&r.remember_user&&o.location.replace("/learn/overview"),i.indexOf(c)>-1&&!l&&!u&&o.location.replace("/403"),s.indexOf(c)>-1&&!u&&o.location.replace("/403")}]);var AdminController=function(){function t(t){t.setTitleAndNav("Admin | Crucio","Admin")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("admincomponent",{templateUrl:"app/admin/admin.html",controller:AdminController});var AdminActivityController=function(){function t(t,e,o,n){var i=this;this.API=o,t.setTitleAndNav("Statistik | Crucio","Admin"),this.updateActivity=!1,this.showActivity={result:!0,login:!0,register:!0,comment:!0,examNew:!0,examUpdate:!0},n(function(){i.updateActivity&&i.loadActivity()},2500),this.loadActivity()}return t.$inject=["Page","Auth","API","$interval"],t.prototype.loadActivity=function(){var t=this,e={result:0|this.showActivity.result,login:0|this.showActivity.login,register:0|this.showActivity.register,comment:0|this.showActivity.comment,examNew:0|this.showActivity.examNew,examUpdate:0|this.showActivity.examUpdate};this.API.get("stats/activities",e,!0).then(function(e){t.activities=e.data.activities})},t}();angular.module("crucioApp").component("adminactivitycomponent",{templateUrl:"app/admin/activity/activity.html",controller:AdminActivityController});var AdminStatsController=function(){function t(t,e){var o=this;this.API=e,this.API.get("stats/summary").then(function(t){o.stats=t.data.stats})}return t.$inject=["Auth","API"],t}();angular.module("crucioApp").component("adminstatscomponent",{templateUrl:"app/admin/stats/stats.html",controller:AdminStatsController});var AdminToolsController=function(){function t(t,e){this.API=e}return t.$inject=["Auth","API"],t.prototype.changeSemester=function(t){var e={difference:t};this.API.put("users/change-semester",e).then(function(t){alert(t.data.status)})},t.prototype.removeTestAccount=function(){this.API.delete("users/test-account").then(function(t){alert(t.data.status)})},t}();angular.module("crucioApp").component("admintoolscomponent",{templateUrl:"app/admin/tools/tools.html",controller:AdminToolsController});var DeleteUserModalController=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.$onInit=function(){this.user=this.resolve.user},t.prototype.deleteUser=function(){this.API.delete("users/"+this.user.user_id),this.close({$value:"delete"})},t}();angular.module("crucioApp").component("deleteUserModalComponent",{templateUrl:"app/admin/users/delete-user-modal.html",controller:DeleteUserModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var UserModalController=function(){function t(t){var e=this;this.API=t,this.API.get("users/distinct").then(function(t){e.distinctGroups=t.data.groups,e.distinctGroupsPerId={};for(var o=0,n=e.distinctGroups;o<n.length;o++){var i=n[o];e.distinctGroupsPerId[i.group_id]=i.name}})}return t.$inject=["API"],t.prototype.$onInit=function(){this.user=this.resolve.user,this.newGroupID=this.user.group_id},t.prototype.deleteUser=function(){this.API.delete("users/"+this.user.user_id),this.close({$value:"delete"})},t.prototype.save=function(){this.user.group_id=this.newGroupID;var t={group_id:this.newGroupID};this.API.put("users/"+this.user.user_id+"/group",t),this.close({$value:"save"})},t}();angular.module("crucioApp").component("userModalComponent",{templateUrl:"app/admin/users/user-modal.html",controller:UserModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var AdminUsersController=function(){function t(t,e,o){var n=this;this.API=e,this.$uibModal=o,this.user=t.getUser(),this.userSearch={},this.API.get("users/distinct").then(function(t){n.distinctGroups=t.data.groups,n.distinctSemesters=t.data.semesters,n.distinctGroupsPerId={};for(var e=0,o=n.distinctGroups;e<o.length;e++){var i=o[e];n.distinctGroupsPerId[i.group_id]=i.name}}),this.loadUsers()}return t.$inject=["Auth","API","$uibModal"],t.prototype.loadUsers=function(){var t=this,e={semester:this.userSearch.semester,group_id:this.userSearch.group,query:this.userSearch.query,limit:100};this.API.get("users",e).then(function(e){t.users=e.data.users})},t.prototype.changeGroup=function(t){var e=this.users[t].user_id,o=this.users[t].group_id;o=o%this.distinctGroups.length+1,this.users[t].group_id=o;for(var n=0,i=this.distinctGroups;n<i.length;n++){var s=i[n];if(s.group_id===o){this.users[t].group_name=s.name;break}}var r={group_id:o};this.API.put("users/"+e+"/group",r,!0)},t.prototype.isToday=function(t,e){void 0===e&&(e=0);var o=new Date,n=o-36e5*e,i=new Date(n),s=new Date(1e3*t);return i.toDateString()===s.toDateString()},t.prototype.deleteUserModal=function(t){var e=this,o=this.$uibModal.open({component:"deleteUserModalComponent",resolve:{user:function(){return e.users[t]}}});o.result.then(function(o){"delete"==o&&e.users.splice(t,1)})},t}();angular.module("crucioApp").component("adminuserscomponent",{templateUrl:"app/admin/users/users.html",controller:AdminUsersController});var AdminWhitelistController=function(){function t(t,e){var o=this;this.API=e,this.API.get("whitelist").then(function(t){o.whitelist=t.data.whitelist})}return t.$inject=["Auth","API"],t.prototype.addMail=function(){var t=this.newWhitelistEmail;if(t){this.whitelist.push({mail_address:t,username:""});var e={email:t};this.API.post("whitelist",e)}},t.prototype.removeMail=function(t){var e=this.whitelist[t].mail_address;e&&(this.whitelist.splice(t,1),this.API.delete("whitelist/"+e))},t}();angular.module("crucioApp").component("adminwhitelistcomponent",{templateUrl:"app/admin/whitelist/whitelist.html",controller:AdminWhitelistController});var AuthorController=function(){function t(t){t.setTitleAndNav("Autor | Crucio","Author")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("authorcomponent",{templateUrl:"app/author/author.html",controller:AuthorController});var AuthorAdivcesController=function(){function t(){}return t}();angular.module("crucioApp").component("authoradvicescomponent",{templateUrl:"app/author/advices/advices.html",controller:AuthorAdivcesController});var AuthorCommentsController=function(){function t(t,e){var o=this;this.API=e,this.user=t.getUser(),this.commentSearch={author:this.user},this.API.get("exams/distinct").then(function(t){o.distinctAuthors=t.data.authors}),this.loadComments()}return t.$inject=["Auth","API"],t.prototype.loadComments=function(){var t=this,e={author_id:this.commentSearch.author&&this.commentSearch.author.user_id,query:this.commentSearch.query,limit:100};this.API.get("comments/author",e).then(function(e){t.comments=e.data.comments,t.questionsByComment=[];for(var o=0,n=t.comments;o<n.length;o++){for(var i=n[o],s=-1,r=0;r<t.questionsByComment.length;r++)if(t.questionsByComment[r][0].question===i.question){s=r;break}s>0?t.questionsByComment[s].push(i):t.questionsByComment.push([i])}t.questionsByComment.sort(function(t,e){return e[0].date-t[0].date})})},t}();angular.module("crucioApp").component("authorcommentscomponent",{templateUrl:"app/author/comments/comments.html",controller:AuthorCommentsController});var DeleteExamModalController=function(){function t(t,e){this.API=t,this.$location=e}return t.$inject=["API","$location"],t.prototype.$onInit=function(){this.examId=this.resolve.examId},t.prototype.deleteExam=function(){var t=this;this.API.delete("exams/"+this.examId).then(function(){t.close({$value:"ok"}),t.$location.url("/author/exams")})},t}();angular.module("crucioApp").component("deleteExamModalComponent",{templateUrl:"app/author/edit-exam/delete-exam-modal.html",controller:DeleteExamModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var EditExamController=function(){function t(t,e,o,n,i,s,r,a,u){var l=this;this.API=o,this.Cut=n,this.FileUploader=i,this.$location=r,this.$uibModal=u,t.setTitleAndNav("Klausur | Crucio","Author"),this.user=e.getUser(),this.examId=a.examId,this.openQuestionId=parseInt(a.questionId,0),this.openQuestionIndex=-1,this.numberChanged=-3,this.uploader=new i({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(t,e){l.exam.file_name=e.upload_name},this.uploaderArray=[],this.exam_types=["Erstklausur","Wiederholungsklausur","Leistungskontrolle","Fragensammlung","Testat","Sonstiges"],s.$watch(function(){return l.exam},function(){l.hasChanged=l.numberChanged>0,l.numberChanged+=1},!0),s.$watch(function(){return l.questions},function(){l.hasChanged=l.numberChanged>0,l.numberChanged+=1},!0),s.$on("$locationChangeStart",function(t){if(l.hasChanged){var e=confirm("Die Änderungen an der Klausur bleiben dann ungespeichert. Wirklich verlassen?");e||t.preventDefault()}}),this.API.get("subjects").then(function(t){l.subjectList=t.data.subjects,l.subjectListPerId={},l.categoryListPerId={};for(var e=0,o=l.subjectList;e<o.length;e++){var n=o[e];l.subjectListPerId[n.subject_id]=n.subject,l.categoryListPerId[n.subject_id]=n.categories,l.categoryListPerId[n.subject_id].unshift({category_id:0,category:"Sonstiges"})}}),this.loadExam()}return t.$inject=["Page","Auth","API","Cut","FileUploader","$scope","$location","$stateParams","$uibModal"],t.prototype.loadExam=function(){var t=this;this.API.get("exams/"+this.examId).then(function(e){t.exam=e.data.exam,t.questions=e.data.questions;for(var o=0;o<t.questions.length;o++)if(t.questions[o].question_id===t.openQuestionId){t.openQuestionIndex=o;break}t.remakeUploaderArray(),0===t.questions.length&&t.addQuestion(!1),t.ready=!0})},t.prototype.remakeUploaderArray=function(){var t=this;this.uploaderArray=[];for(var e=0;e<this.questions.length;e++){var o=new this.FileUploader({url:"/api/v1/file/upload",formData:e});o.onSuccessItem=function(e,o){var n=e.formData;t.questions[n].question_image_url=o.upload_name},this.uploaderArray.push(o)}},t.prototype.addQuestion=function(t){var e={category_id:0,question:"",type:5,correct_answer:0,answers:["","","","","",""]};this.questions.push(e),t&&(this.openQuestionIndex=this.questions.length-1),this.remakeUploaderArray()},t.prototype.deleteQuestion=function(t){var e=this.questions[t].question_id;e&&this.API.delete("questions/"+e),this.questions.splice(t,1),this.openQuestionIndex=Math.min(this.openQuestionIndex,this.questions.length-1),this.remakeUploaderArray(),this.questions||this.addQuestion(!0)},t.prototype.saveExam=function(){var t=this.exam.subject_id&&this.exam.semester>0&&this.exam.semester<=50&&this.exam.date;if(t){this.isSaving=!0,this.API.put("exams/"+this.examId,this.exam).then(function(t){t.data.status||alert("Fehler beim Speichern der Klausur.")});for(var e=function(t){var e=t.question||t.question_id;if(e){t.explanation=t.explanation||"",t.question_image_url=t.question_image_url||"";var n={exam_id:o.exam.exam_id,user_id_added:o.user.user_id,category_id:t.category_id,question:t.question,type:t.type,answers:t.answers,correct_answer:t.correct_answer,explanation:t.explanation,question_image_url:t.question_image_url};t.question_id?o.API.put("questions/"+t.question_id,n):o.API.post("questions",n).then(function(e){t.question_id=e.data.question_id})}},o=this,n=0,i=this.questions;n<i.length;n++){var s=i[n];e(s)}this.hasChanged=!1,this.numberChanged=0,this.isSaving=!1}else alert("Es fehlen noch allgemeine Infos zur Klausur.")},t.prototype.deleteExamModal=function(){var t=this;this.$uibModal.open({component:"deleteExamModalComponent",resolve:{examId:function(){return t.examId}}})},t}();angular.module("crucioApp").component("editexamcomponent",{templateUrl:"app/author/edit-exam/edit-exam.html",controller:EditExamController});var DeleteOralExamModalController=function(){function t(t,e){this.API=t,this.$location=e}return t.$inject=["API","$location"],t.prototype.$onInit=function(){this.oralExamId=this.resolve.oralExamId},t.prototype.deleteOralExam=function(){var t=this;this.API.delete("oral_exams/"+this.oralExamId).then(function(){t.close({$value:"ok"}),t.$location.url("/author/oral-exams")})},t}();angular.module("crucioApp").component("deleteOralExamModalComponent",{templateUrl:"app/author/edit-oral-exam/delete-oral-exam-modal.html",controller:DeleteOralExamModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var EditOralExamController=function(){function t(t,e,o,n,i,s,r,a){var u=this;this.API=o,this.FileUploader=n,this.$location=s,this.$uibModal=a,t.setTitleAndNav("Mündliche Prüfung | Crucio","Author"),this.user=e.getUser(),this.oralExamId=r.oralExamId,this.numberChanged=-1,this.uploader=new n({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(t,e){u.oralExam.filename=e.upload_name},i.$watch(function(){return u.oralExam},function(){u.hasChanged=u.numberChanged>0,u.numberChanged+=1},!0),i.$on("$locationChangeStart",function(t){if(u.hasChanged){var e=confirm("Die Änderungen an der Prüfung bleiben dann ungespeichert. Wirklich verlassen?");e||t.preventDefault()}}),this.loadOralExam()}return t.$inject=["Page","Auth","API","FileUploader","$scope","$location","$stateParams","$uibModal"],t.prototype.loadOralExam=function(){var t=this;this.API.get("oral_exams/"+this.oralExamId).then(function(e){t.oralExam=e.data.oral_exam,t.ready=!0}),this.ready=!0},t.prototype.saveOralExam=function(){var t=this,e=this.oralExam.semester>=0&&this.oralExam.semester<=1;e?(this.isSaving=!0,this.API.put("oral_exams/"+this.oralExamId,this.oralExam).then(function(e){e.data.status||alert("Fehler beim Speichern der Klausur."),t.hasChanged=!1,t.numberChanged=0,t.isSaving=!1})):alert("Es fehlen noch allgemeine Infos zur Klausur.")},t.prototype.deleteOralExamModal=function(){var t=this;this.$uibModal.open({component:"deleteOralExamModalComponent",resolve:{oralExamId:function(){return t.oralExamId}}})},t}();angular.module("crucioApp").component("editoralexamcomponent",{templateUrl:"app/author/edit-oral-exam/edit-oral-exam.html",controller:EditOralExamController});var AuthorExamsController=function(){function t(t,e,o){var n=this;this.API=e,this.$location=o,this.user=t.getUser(),this.examSearch={author:this.user},this.API.get("exams/distinct").then(function(t){n.distinctSemesters=t.data.semesters,n.distinctAuthors=t.data.authors,n.distinctSubjects=t.data.subjects}),this.API.get("subjects").then(function(t){n.subjectList=t.data.subjects}),this.loadExams()}return t.$inject=["Auth","API","$location"],t.prototype.loadExams=function(){var t=this,e={subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,author_id:this.examSearch.author&&this.examSearch.author.user_id,semester:this.examSearch.semester,query:this.examSearch.query,limit:200,showEmpty:!0};this.API.get("exams",e).then(function(e){t.exams=e.data.exams})},t.prototype.newExam=function(){var t=this,e={subject_id:1,user_id_added:this.user.user_id,sort:"Erstklausur"};this.API.post("exams",e).then(function(e){t.$location.path("/edit-exam").search("examId",e.data.exam_id)})},t}();angular.module("crucioApp").component("authorexamscomponent",{templateUrl:"app/author/exams/exams.html",controller:AuthorExamsController});var AuthorOralExamsController=function(){function t(t,e,o){var n=this;this.API=e,this.$location=o,this.user=t.getUser(),this.oralExamSearch={},this.API.get("oral_exams/distinct").then(function(t){n.distinctOralYears=t.data.years}),this.loadOralExams()}return t.$inject=["Auth","API","$location"],t.prototype.loadOralExams=function(){var t=this,e={semester:this.oralExamSearch.semester,year:this.oralExamSearch.year,query:this.oralExamSearch.query,limit:200};this.API.get("oral_exams",e).then(function(e){t.oralExams=e.data.oral_exams})},t.prototype.newOralExam=function(){var t=this,e={examiner_count:3,semester:0,year:2016};this.API.post("oral_exams",e).then(function(e){t.$location.path("/edit-oral-exam").search("oralExamId",e.data.oral_exam_id)})},t}();angular.module("crucioApp").component("authororalexamscomponent",{templateUrl:"app/author/oral-exams/oral-exams.html",controller:AuthorOralExamsController});var AuthorSubjectsController=function(){function t(t){var e=this;this.API=t,this.API.get("subjects").then(function(t){e.subjectList=t.data.subjects})}return t.$inject=["API"],t}();angular.module("crucioApp").component("authorsubjectscomponent",{templateUrl:"app/author/subjects/subjects.html",controller:AuthorSubjectsController});var TimeagoController=function(){function t(){}return t.prototype.$onInit=function(){function t(t,e){var n=o.numbers&&o.numbers[e]||e;return t.replace(/%d/i,n)}function e(t){return t.replace(/^\s+|\s+$/g,"")}var o={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren",wordSeparator:" ",numbers:[]},n=this.datetime,i=(new Date).getTime(),s=Math.abs(i-n),r=s/1e3,a=r/60,u=a/60,l=u/24,c=l/365,h=o.prefixAgo,m=o.suffixAgo,p=r<45&&t(o.seconds,Math.round(r))||r<90&&t(o.minute,1)||a<45&&t(o.minutes,Math.round(a))||a<90&&t(o.hour,1)||u<24&&t(o.hours,Math.round(u))||u<42&&t(o.day,1)||l<30&&t(o.days,Math.round(l))||l<45&&t(o.month,1)||l<365&&t(o.months,Math.round(l/30))||c<1.5&&t(o.year,1)||t(o.years,Math.round(c));this.result=e([h,p,m].join(o.wordSeparator))},t}();angular.module("crucioApp").component("timeago",{template:"<span>{{ $ctrl.result }}</span>",controller:TimeagoController,bindings:{datetime:"<"}});var ImageModalController=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.$onInit=function(){this.data=this.resolve.data},t}();angular.module("crucioApp").component("imageModalComponent",{templateUrl:"app/components/image-modal/image-modal.html",controller:ImageModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var NavbarController=function(){function t(t,e){this.Page=e,this.Auth=t,this.user=t.getUser()}return t.$inject=["Auth","Page"],t.prototype.logout=function(){this.Auth.logout()},t}();angular.module("crucioApp").component("navbar",{templateUrl:"app/components/navbar/navbar.html",controller:NavbarController});var QuestionModalController=function(){function t(t,e,o){this.Auth=e,this.API=t,this.$uibModal=o,this.user=e.getUser(),this.commentsCollapsed=Boolean(this.user.showComments),this.noAnswer=!0,this.showExplanation=!1}return t.$inject=["API","Auth","$uibModal"],t.prototype.$onInit=function(){this.question=this.resolve.question,this.questionId=this.resolve.questionId,this.loadQuestion()},t.prototype.loadQuestion=function(){var t=this;this.API.get("questions/"+this.questionId+"/user/"+this.user.user_id).then(function(e){t.question=e.data.question,t.comments=e.data.comments,t.tags=[],e.data.tags&&(t.tags=e.data.tags.split(",").map(function(t){return{text:t}})),t.checkedAnswer=t.givenAnswer})},t.prototype.updateTags=function(t){var e=this.tags.map(function(t){return t.text}).join(","),o={tags:e,question_id:this.questionId,user_id:this.user.user_id};this.API.post("tags",o)},t.prototype.showSolution=function(){var t=this.question.correct_answer;this.checkedAnswer=t;var e=t===this.givenAnswer?1:0;0!==t&&1!==this.question.type||(e=-1);var o={correct:e,question_id:this.questionId,user_id:this.user.user_id,given_result:this.givenAnswer};this.API.post("results",o),this.markAnswer(this.givenAnswer)},t.prototype.saveAnswer=function(t){this.givenAnswer=t},t.prototype.markAnswer=function(t){this.isAnswerGiven=!0;var e=this.question.type;e>1&&(this.correctAnswer=this.question.correct_answer,this.checkedAnswer=t>0?t:this.correctAnswer,this.isAnswerRight=t===this.correctAnswer,this.isAnswerWrong=t!==this.correctAnswer,t!==this.correctAnswer&&(this.wrongAnswer=t))},t.prototype.addComment=function(){var t=this,e=+new Date/1e3,o={comment:this.commentText,question_id:this.questionId,reply_to:0,username:this.user.username,date:e};this.API.post("comments/"+this.user.user_id,o).then(function(e){var n=__assign({},o,{voting:0,user_voting:0,comment_id:e.data.comment_id});t.comments.push(n),t.commentText=""})},t.prototype.deleteComment=function(t){var e=this.comments[t].comment_id;this.API.delete("comments/"+e),this.comments.splice(t,1)},t.prototype.changeUserVoting=function(t,e){t.user_voting=Math.min(Math.max(t.user_voting+e,-1),1);var o={user_voting:t.user_voting};this.API.post("comments/"+t.comment_id+"/user/"+this.user.user_id,o)},t.prototype.openImageModal=function(){var t=this;this.$uibModal.open({component:"imageModalComponent",resolve:{data:function(){return t.question.question_image_url}}})},t.prototype.openReportModal=function(){var t=this;this.$uibModal.open({component:"reportModalComponent",resolve:{questionId:function(){return t.questionId},question:function(){return t.question}}})},t}();angular.module("crucioApp").component("questionModalComponent",{templateUrl:"app/components/question-modal/question-modal.html",controller:QuestionModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var ReportModalController=function(){function t(t,e,o){this.Auth=e,this.API=t,this.$uibModal=o,this.user=e.getUser()}return t.$inject=["API","Auth","$uibModal"],t.prototype.$onInit=function(){this.questionId=this.resolve.questionId,this.question=this.resolve.question},t.prototype.reportQuestion=function(){var t=this,e=this.message;if(e){var o={text:this.message,name:this.user.username,email:this.user.email,question_id:this.questionId,author:this.question.username,question:this.question.question,exam_id:this.question.exam_id,subject:this.question.subject,date:this.question.date,author_email:this.question.email,mail_subject:"Allgemein"};this.API.post("contact/send-mail-question",o).then(function(){t.close({$value:"reported"})})}},t}();angular.module("crucioApp").component("reportModalComponent",{templateUrl:"app/components/report-modal/report-modal.html",controller:ReportModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var ErrorController=function(){function t(t){t.setTitleAndNav("Fehler | Crucio","")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("error403component",{templateUrl:"app/error/403.html",controller:ErrorController}),angular.module("crucioApp").component("error404component",{templateUrl:"app/error/404.html",controller:ErrorController}),angular.module("crucioApp").component("error500component",{templateUrl:"app/error/500.html",controller:ErrorController});var HelpController=function(){function t(t,e,o){this.API=o,e.setTitleAndNav("Hilfe | Crucio",""),this.user=t.getUser()}return t.$inject=["Auth","Page","API"],t.prototype.sendMail=function(){var t=this,e=this.text;if(e){this.isWorking=!0;var o={text:this.text,name:this.user.username,email:this.user.email};this.API.post("contact/send-mail",o).then(function(){t.isWorking=!1,t.emailSend=!0})}},t}();angular.module("crucioApp").component("helpcomponent",{templateUrl:"app/help/help.html",controller:HelpController});var LearnController=function(){function t(t){t.setTitleAndNav("Lernen | Crucio","Learn")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("learncomponent",{templateUrl:"app/learn/learn.html",controller:LearnController});var AnalysisController=function(){function t(t,e,o,n){function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}var s=this;this.API=o,t.setTitleAndNav("Analyse | Crucio","Learn"),this.user=e.getUser();for(var r=0,a=n.get().list;r<a.length;r++){var u=a[r];if(!u.mark_answer&&u.type>1&&u.given_result>0){var l=u.correct_answer===u.given_result?1:0;0!==u.correct_answer&&1!==u.type||(l=-1);var c={correct:l,given_result:u.given_result,question_id:u.question_id,user_id:this.user.user_id};this.API.post("results",c)}}this.random=i(0,1e3),this.examId=n.get().exam_id,this.workedCollection=n.getWorked(),this.count=n.analyseCount(),this.examId&&this.API.get("exams/"+this.examId).then(function(t){s.exam=t.data.exam})}return t.$inject=["Page","Auth","API","Collection"],t.prototype.showCorrectAnswerClicked=function(t){this.workedCollection[t].show_correct_answer=1},t}();angular.module("crucioApp").component("analysiscomponent",{templateUrl:"app/learn/analysis/analysis.html",controller:AnalysisController});var LearnCommentsController=function(){function t(t,e){this.API=e,this.user=t.getUser(),this.commentSearch={},this.loadComments()}return t.$inject=["Auth","API"],t.prototype.loadComments=function(){var t=this,e={query:this.commentSearch.query,user_id:this.user.user_id};this.API.get("comments",e).then(function(e){t.comments=e.data.comments,t.questionsByComment={};for(var o=0,n=t.comments;o<n.length;o++){var i=n[o];t.questionsByComment[i.question]=t.questionsByComment[i.question]||[],t.questionsByComment[i.question].push(i)}})},t}();angular.module("crucioApp").component("learncommentscomponent",{templateUrl:"app/learn/comments/comments.html",controller:LearnCommentsController});var ExamController=function(){function t(t,e,o,n,i,s,r,a,u,l){var c=this;this.API=o,this.Collection=n,this.$location=i,this.$document=u,this.$uibModal=s,t.setTitleAndNav("Klausur | Crucio","Learn"),this.user=e.getUser(),this.examId=r.examId,this.currentIndex=0,u.on("scroll",function(){for(var t=u.scrollTop(),e=function(e){var o=angular.element(l.document.getElementById("id"+e));return o.prop("offsetTop")>t&&(a(function(){c.currentIndex=Math.max(e-1,0)},0),!0)},o=0;o<c.Collection.get().list.length&&!e(o);o++);}),this.loadExam()}return t.$inject=["Page","Auth","API","Collection","$location","$uibModal","$stateParams","$timeout","$document","$window"],t.prototype.loadExam=function(){var t=this;this.API.get("exams/"+this.examId).then(function(e){t.exam=e.data.exam,t.length=e.data.questions.length,t.Collection.set({type:"exam",exam_id:t.examId,list:e.data.questions})})},t.prototype.handExam=function(){this.$location.path("/analysis").search("id",null)},t.prototype.openImageModal=function(t){this.$uibModal.open({component:"imageModalComponent",resolve:{data:function(){return t}}})},t}();angular.module("crucioApp").component("examcomponent",{templateUrl:"app/learn/exam/exam.html",controller:ExamController});var LearnExamsController=function(){function t(t,e,o,n,i,s){var r=this;this.API=e,this.Collection=o,this.$location=i,this.user=t.getUser(),this.examSearch={semester:this.user.semester},this.API.get("exams/distinct",{visibility:1}).then(function(t){r.distinctSemesters=t.data.semesters,r.distinctSubjects=t.data.subjects}),this.loadExams()}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadExams=function(){var t=this,e={user_id:this.user.user_id,
semester:this.examSearch.semester,subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,query:this.examSearch.query,visibility:1};this.API.get("exams",e).then(function(e){t.exams=e.data.exams})},t.prototype.learnExam=function(t){var e=this,o={random:!1};this.Collection.prepareExam(t,o).then(function(t){e.$location.path("/question").search("questionId",t.list[0].question_id)})},t.prototype.resetExam=function(t){t.answered_questions=0,this.API.delete("results/"+this.user.user_id+"/"+t.exam_id,!0)},t}();angular.module("crucioApp").component("learnexamscomponent",{templateUrl:"app/learn/exams/exams.html",controller:LearnExamsController});var LearnOralExamsController=function(){function t(t,e,o,n,i){var s=this;this.API=e,this.user=t.getUser(),this.oralExamSearch={semester:this.user.semester<=4?0:1},this.API.get("oral_exams/distinct",{visibility:1}).then(function(t){s.distinctOralSemesters=t.data.semesters,s.distinctOralYears=t.data.years})}return t.$inject=["Auth","API","$scope","$location","$timeout"],t.prototype.searchOralExams=function(){var t=this;if(this.oralExams=[],this.hasSearched=!1,this.oralExamSearch.query){var e={semester:this.oralExamSearch.semester,year:this.oralExamSearch.year,query:this.oralExamSearch.query,limit:200};this.API.get("oral_exams",e,!0).then(function(e){t.oralExams=e.data.oral_exams,t.hasSearched=!0})}},t}();angular.module("crucioApp").component("learnoralexamscomponent",{templateUrl:"app/learn/oral-exams/oral-exams.html",controller:LearnOralExamsController});var LearnOverviewController=function(){function t(t,e,o,n,i,s){var r=this;this.API=e,this.Collection=o,this.$location=i,this.user=t.getUser(),this.API.get("exams/distinct",{visibility:1}).then(function(t){r.distinctSemesters=t.data.semesters,r.distinctSubjects=t.data.subjects}),this.loadOverview()}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadOverview=function(){var t=this,e={limit:12};this.API.get("exams/abstract/"+this.user.user_id,e).then(function(e){t.abstractExams=e.data.exams,t.ready=1})},t.prototype.learnExam=function(t){var e=this,o={random:!1};this.Collection.prepareExam(t,o).then(function(t){e.$location.path("/question").search("questionId",t.list[0].question_id)})},t.prototype.resetExam=function(t){t.answered_questions=0,this.API.delete("results/"+this.user.user_id+"/"+t.exam_id,!0)},t}();angular.module("crucioApp").component("learnoverviewcomponent",{templateUrl:"app/learn/overview/overview.html",controller:LearnOverviewController});var QuestionController=function(){function t(t,e,o,n,i,s,r){if(this.Auth=t,this.API=o,this.Collection=n,this.$uibModal=r,e.setTitleAndNav("Frage | Crucio","Learn"),this.user=t.getUser(),this.questionId=Number(i.questionId),this.resetSession=Boolean(i.resetSession),this.commentsCollapsed=Boolean(this.user.showComments),this.questionId||(alert("Fehler: Konnte keine Frage finden."),s.location.replace("/learn/overview")),this.noAnswer=!0,this.showExplanation=!1,this.resetSession)this.index=-1,delete this.collection,n.remove(),this.questionData=void 0;else if(this.collection=this.Collection.get(),this.index=this.Collection.getIndexOfQuestion(this.questionId),this.index>-1){var a=this.collection.list;this.questionData=this.Collection.getQuestionData(this.index),this.length=a.length,this.preQuestionId=this.index>0?a[this.index-1].question_id:this.questionId,this.postQuestionId=this.index<this.length-1?a[this.index+1].question_id:this.questionId}this.loadQuestion()}return t.$inject=["Auth","Page","API","Collection","$stateParams","$window","$uibModal"],t.prototype.loadQuestion=function(){var t=this;this.API.get("questions/"+this.questionId+"/user/"+this.user.user_id).then(function(e){t.question=e.data.question,t.comments=e.data.comments,t.tags=[],e.data.tags&&(t.tags=e.data.tags.split(",").map(function(t){return{text:t}})),t.checkedAnswer=t.questionData.givenAnswer,t.questionData.mark_answer&&t.markAnswer(t.questionData.givenAnswer)})},t.prototype.updateTags=function(t){var e=this.tags.map(function(t){return t.text}).join(","),o={tags:e,question_id:this.questionId,user_id:this.user.user_id};this.API.post("tags",o,!0)},t.prototype.showSolution=function(){var t=this.question.correct_answer;this.checkedAnswer=t;var e=t===this.questionData.givenAnswer?1:0;0!==t&&1!==this.question.type||(e=-1);var o={correct:e,question_id:this.questionId,user_id:this.user.user_id,given_result:this.questionData.givenAnswer};this.API.post("results",o,!0),this.Collection.saveMarkAnswer(this.index),this.markAnswer(this.questionData.givenAnswer)},t.prototype.saveAnswer=function(t){this.questionData.givenAnswer=t,this.Collection.saveAnswer(this.index,this.questionData.givenAnswer)},t.prototype.markAnswer=function(t){this.isAnswerGiven=!0;var e=this.question.type;e>1&&(this.correctAnswer=this.question.correct_answer,this.checkedAnswer=t>0?t:this.correctAnswer,this.isAnswerRight=t===this.correctAnswer,this.isAnswerWrong=t!==this.correctAnswer,t!==this.correctAnswer&&(this.wrongAnswer=t))},t.prototype.addComment=function(){var t=this,e=+new Date/1e3,o={comment:this.commentText,question_id:this.questionId,reply_to:0,username:this.user.username,date:e};this.API.post("comments/"+this.user.user_id,o).then(function(e){o.voting=0,o.user_voting=0,o.comment_id=e.data.comment_id,t.comments.push(o),t.commentText=""})},t.prototype.deleteComment=function(t){var e=this.comments[t].comment_id;this.API.delete("comments/"+e),this.comments.splice(t,1)},t.prototype.changeUserVoting=function(t,e){t.user_voting=Math.min(Math.max(t.user_voting+e,-1),1);var o={user_voting:t.user_voting};this.API.post("comments/"+t.comment_id+"/user/"+this.user.user_id,o,!0)},t.prototype.openImageModal=function(){var t=this;this.$uibModal.open({component:"imageModalComponent",resolve:{data:function(){return t.question.question_image_url}}})},t.prototype.openReportModal=function(){var t=this;this.$uibModal.open({component:"reportModalComponent",resolve:{question:function(){return t.question},questionId:function(){return t.questionId}}})},t}();angular.module("crucioApp").component("questioncomponent",{templateUrl:"app/learn/question/question.html",controller:QuestionController});var LearnSearchController=function(){function t(t,e){var o=this;this.API=e,this.user=t.getUser(),this.questionSearch={semester:this.user.semester},this.API.get("exams/distinct",{visibility:1}).then(function(t){o.distinctSemesters=t.data.semesters,o.distinctSubjects=t.data.subjects}),this.limit=100}return t.$inject=["Auth","API"],t.prototype.searchQuestion=function(){var t=this;if(this.searchResults=[],this.hasSearched=!1,this.questionSearch.query){this.showSpinner=!0;var e={query:this.questionSearch.query,subject_id:this.questionSearch.subject&&this.questionSearch.subject.subject_id,semester:this.questionSearch.semester,visibility:1,limit:this.limit};this.API.get("questions",e,!0).then(function(e){t.searchResults=e.data.result,t.showSpinner=!1,t.hasSearched=!0})}},t}();angular.module("crucioApp").component("learnsearchcomponent",{templateUrl:"app/learn/search/search.html",controller:LearnSearchController});var StatisticController=function(){function t(t,e){e.setTitleAndNav("Statistik | Crucio","Learn"),this.user=t.getUser()}return t.$inject=["Auth","Page"],t}();angular.module("crucioApp").component("statisticcomponent",{templateUrl:"app/learn/statistic/statistic.html",controller:StatisticController});var LearnSubjectsController=function(){function t(t,e,o,n,i,s){var r=this;this.API=e,this.Collection=o,this.$location=i,this.user=t.getUser(),this.selection={},this.selectedQuestionNumber=0,this.numberQuestionsInSelection=0,this.sliderOptions={floor:0,ceil:this.numberQuestionsInSelection},s(function(){n.$broadcast("rzSliderForceRender")}),this.API.get("exams/distinct",{visibility:1}).then(function(t){r.distinctSemesters=t.data.semesters,r.distinctSubjects=t.data.subjects}),this.API.get("subjects",{has_questions:!0}).then(function(t){r.subjectList=t.data.subjects})}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadNumberQuestions=function(){var t=this,e={selection:this.selection};this.API.get("questions/count",e,!0).then(function(e){t.numberQuestionsInSelection=e.data.count;var o=Math.min(t.numberQuestionsInSelection,500);t.sliderOptions={floor:0,ceil:o},t.selectedQuestionNumber||(t.selectedQuestionNumber=50),t.selectedQuestionNumber=Math.min(t.selectedQuestionNumber,t.numberQuestionsInSelection)})},t.prototype.learnSubjects=function(){var t=this,e={selection:this.selection,limit:this.selectedQuestionNumber};this.Collection.prepareSubjects(e).then(function(e){t.$location.path("/question").search("questionId",e.list[0].question_id)})},t}();angular.module("crucioApp").component("learnsubjectscomponent",{templateUrl:"app/learn/subjects/subjects.html",controller:LearnSubjectsController});var LearnTagsController=function(){function t(t,e){this.API=e,this.user=t.getUser(),this.loadTags()}return t.$inject=["Auth","API"],t.prototype.loadTags=function(){var t=this,e={user_id:this.user.user_id};this.API.get("tags",e).then(function(e){t.tags=e.data.tags,t.distinctTags=[];for(var o=0,n=t.tags;o<n.length;o++)for(var i=n[o],s=0,r=i.tags.split(",");s<r.length;s++){var a=r[s];t.distinctTags.includes(a)||t.distinctTags.push(a)}t.questionsByTag={};for(var u=0,l=t.distinctTags;u<l.length;u++){var c=l[u];t.questionsByTag[c]=[];for(var h=0,m=t.tags;h<m.length;h++)for(var i=m[h],p=0,d=i.tags.split(",");p<d.length;p++){var a=d[p];c===a&&t.questionsByTag[c].push(i)}}})},t}();angular.module("crucioApp").component("learntagscomponent",{templateUrl:"app/learn/tags/tags.html",controller:LearnTagsController});var APIService=function(){function t(t){this.$http=t,this.base="api/v1/"}return t.$inject=["$http"],t.prototype.sanitize=function(t){return t.email=t.email&&t.email.replace("@","(@)"),t},t.prototype.get=function(t,e,o){return void 0===e&&(e={}),void 0===o&&(o=!1),this.$http.get(this.base+t,{params:this.sanitize(e)})},t.prototype.post=function(t,e,o){return void 0===o&&(o=!1),this.$http.post(this.base+t,this.sanitize(e))},t.prototype.put=function(t,e,o){return void 0===o&&(o=!1),this.$http.put(this.base+t,this.sanitize(e))},t.prototype.delete=function(t,e,o){return void 0===e&&(e={}),void 0===o&&(o=!1),this.$http.delete(this.base+t,{params:this.sanitize(e)})},t}();angular.module("crucioApp").service("API",APIService);var AuthService=function(){function t(t,e){this.$window=e,this.$cookies=t}return t.$inject=["$cookies","$window"],t.prototype.getUser=function(){return this.tryGetUser(),this.user||this.$window.location.replace("/"),this.user},t.prototype.tryGetUser=function(){return angular.isUndefined(this.user)&&angular.isDefined(this.$cookies.getObject("CrucioUser"))&&this.setUser(this.$cookies.getObject("CrucioUser")),this.user},t.prototype.logout=function(){this.$cookies.remove("CrucioUser"),this.$window.location.assign(this.$window.location.origin)},t.prototype.setUser=function(t,e){if(void 0===e&&(e=!1),this.user=t,e||angular.isDefined(this.$cookies.getObject("CrucioUser"))){var o=new Date;o.setDate(o.getDate()+21),this.$cookies.putObject("CrucioUser",this.user,{expires:o})}this.user.remember_me||this.$cookies.remove("CrucioUser")},t}();angular.module("crucioApp").service("Auth",AuthService);var CollectionService=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.get=function(){return angular.isUndefined(this.collection)&&angular.isDefined(sessionStorage.crucioCollection)&&this.set(angular.fromJson(sessionStorage.crucioCollection)),this.collection},t.prototype.set=function(t){this.collection=t,sessionStorage.crucioCollection=angular.toJson(t)},t.prototype.remove=function(){delete this.collection,sessionStorage.removeItem("crucioCollection")},t.prototype.getWorked=function(){return this.get(),this.collection.list.filter(function(t){return t.given_result})},t.prototype.analyseCount=function(){for(var t=this.getWorked(),e={correct:0,wrong:0,seen:0,solved:0,free:0,no_answer:0,all:this.collection.list.length,worked:t.length},o=0,n=t;o<n.length;o++){var i=n[o];i.correct_answer===i.given_result&&i.given_result>0&&i.correct_answer>0&&e.correct++,i.correct_answer!==i.given_result&&i.given_result>0&&i.correct_answer>0&&e.wrong++,i.given_result>0&&e.solved++,i.given_result>-2&&e.seen++,1===i.type&&e.free++,0===i.correct_answer&&1!==i.type&&e.no_answer++}return e},t.prototype.saveAnswer=function(t,e){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].given_result=e,this.set(this.collection))},t.prototype.saveStrike=function(t,e){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].strike=e,this.set(this.collection))},t.prototype.saveMarkAnswer=function(t){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].mark_answer=1,this.set(this.collection))},t.prototype.prepareExam=function(t,e){var o=this;return this.API.get("exams/action/prepare/"+t,e).then(function(e){var n={type:"exam",list:e.data.list,exam_id:t};return o.set(n),n})},t.prototype.prepareSubjects=function(t){var e=this;return this.API.get("questions/prepare-subjects",t).then(function(o){var n={type:"subjects",list:o.data.list,selection:t.selection};return e.set(n),n})},t.prototype.getIndexOfQuestion=function(t){for(var e=0;e<this.collection.list.length;e++)if(this.collection.list[e].question_id===t)return e;return-1},t.prototype.getQuestionData=function(t){return this.collection.list[t]},t.prototype.isHalftime=function(t){return Math.abs(t+1-this.collection.list.length/2)<1&&t>3},t}();angular.module("crucioApp").service("Collection",CollectionService);var CutService=function(){function t(){}return t.prototype.cut=function(t,e,o,n){if(!t)return"";var i=parseInt(o,10);if(t.length<=i)return t;var s=t.substr(0,i);if(e){var r=s.lastIndexOf(" ");r!==-1&&(s=s.substr(0,r))}return s+(n||" ?")},t}();angular.module("crucioApp").service("Cut",CutService);var PageService=function(){function t(t){this.$window=t}return t.$inject=["$window"],t.prototype.setTitle=function(t){this.title=t},t.prototype.setNav=function(t){this.nav=t},t.prototype.setTitleAndNav=function(t,e){void 0===e&&(e=""),this.title=t,this.nav=e,this.$window.document.title=this.title},t}();angular.module("crucioApp").service("Page",PageService);var DeleteResultsModalController=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.$onInit=function(){this.userId=this.resolve.userId},t.prototype.deleteAllResults=function(){this.API.delete("results/"+this.userId),this.close({$value:"ok"})},t}();angular.module("crucioApp").component("deleteResultsModalComponent",{templateUrl:"app/user/delete-results-modal.html",controller:DeleteResultsModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var DeleteTagsModalController=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.$onInit=function(){this.userId=this.resolve.userId},t.prototype.deleteAllTags=function(){this.API.delete("tags/"+this.userId),this.close({$value:"ok"})},t}();angular.module("crucioApp").component("deleteTagsModalComponent",{templateUrl:"app/user/delete-tags-modal.html",controller:DeleteTagsModalController,bindings:{resolve:"<",close:"&",dismiss:"&"}});var UserController=function(){function t(t,e,o,n,i){this.API=o,this.Auth=e,this.$scope=n,this.$uibModal=i,t.setTitleAndNav("Account | Crucio","User"),this.user=this.Auth.getUser()}return t.$inject=["Page","Auth","API","$scope","$uibModal"],t.prototype.formChanged=function(){this.isSaved=!1,this.hasError=!1,this.$scope.form.passwordc.$setValidity("confirm",this.newPassword===this.newPasswordC)},t.prototype.saveUser=function(){var t=this;this.formChanged(),this.isWorking=!0;var e={course_id:this.user.course_id,semester:this.user.semester,current_password:this.oldPassword,password:this.newPassword};this.API.put("users/"+this.user.user_id+"/account",e,!0).then(function(e){e.data.status?t.Auth.setUser(t.user):(t.user=t.Auth.getUser(),t.hasError=!0),t.isSaved=e.data.status,t.wrongPassword="error_incorrect_password"===e.data.error,t.isWorking=!1});var o={highlightExams:this.user.highlightExams,showComments:this.user.showComments,repetitionValue:50,useAnswers:this.user.useAnswers,useTags:this.user.useTags};this.API.put("users/"+this.user.user_id+"/settings",o,!0).then(function(e){e.data.status?t.Auth.setUser(t.user):(t.user=t.Auth.getUser(),t.hasError=!0),t.isSaved=e.data.status,t.isWorking=!1})},t.prototype.deleteAllResultsModal=function(){var t=this;this.$uibModal.open({component:"deleteResultsModalComponent",resolve:{userId:function(){return t.user.user_id}}})},t.prototype.deleteAllTagsModal=function(){var t=this;this.$uibModal.open({component:"deleteTagsModalComponent",resolve:{userId:function(){return t.user.user_id}}})},t}();angular.module("crucioApp").component("usercomponent",{templateUrl:"app/user/user.html",controller:UserController});