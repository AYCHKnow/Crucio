function Cut(){return function(t,e,o,n){if(!t)return"";var r=parseInt(o,10);if(t.length<=r)return t;var i=t.substr(0,r);if(e){var s=i.lastIndexOf(" ");s!==-1&&(i=i.substr(0,s))}return i+(n||" ?")}}angular.module("crucioApp",["ngCookies","ngMessages","ngTagsInput","ui.router","ui.bootstrap","angularFileUpload","angularSpinner","textAngular","rzModule","duScroll"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$provide",function(t,e,o,n){function r(t){return"<"+t+"Component></"+t+"Component>"}var i=[{name:"learn",url:"/learn",template:r("learn")},{name:"learn.overview",url:"/overview",template:r("learnoverview")},{name:"learn.subjects",url:"/subjects",template:r("learnsubjects")},{name:"learn.exams",url:"/exams",template:r("learnexams")},{name:"learn.search",url:"/search",template:r("learnsearch")},{name:"learn.tags",url:"/tags",template:r("learntags")},{name:"learn.comments",url:"/comments",template:r("learncomments")},{name:"learn.oral-exams",url:"/oral-exams",template:r("learnoralexams")},{name:"question",url:"/question?questionId&resetSession",template:r("question")},{name:"exam",url:"/exam?examId",template:r("exam")},{name:"statistic",url:"/statistic",template:r("statistic")},{name:"analysis",url:"/analysis",template:r("analysis")},{name:"author",url:"/author",template:r("author")},{name:"author.exams",url:"/exams",template:r("authorexams")},{name:"author.comments",url:"/comments",template:r("authorcomments")},{name:"author.subjects",url:"/subjects",template:r("authorsubjects")},{name:"author.oral-exams",url:"/oral-exams",template:r("authororalexams")},{name:"author.advices",url:"/advices",template:r("authoradvices")},{name:"edit-exam",url:"/edit-exam?examId&questionId",template:r("editExam")},{name:"edit-oral-exam",url:"/edit-oral-exam?oralExamId",template:r("editOralExam")},{name:"admin",url:"/admin",template:r("admin")},{name:"admin.users",url:"/users",template:r("adminusers")},{name:"admin.whitelist",url:"/whitelist",template:r("adminwhitelist")},{name:"admin.tools",url:"/tools",template:r("admintools")},{name:"admin.stats",url:"/stats",template:r("adminstats")},{name:"admin.activity",url:"/activity",template:r("adminactivity")},{name:"user",url:"/user",template:r("user")},{name:"403",url:"/403",template:r("error403")},{name:"404",url:"/404",template:r("error404")},{name:"500",url:"/500",template:r("error500")},{name:"help",url:"/help?questionId",template:r("help")}];e.otherwise("/404"),o.html5Mode(!0),i.forEach(function(e){t.state(e)}),n.decorator("taOptions",["taRegisterTool","$delegate",function(t,e){return t("times",{buttontext:"&times;",tooltiptext:"times",action:function(){return this.$editor().wrapSelection("inserthtml","&times;")}}),t("arrow-left",{buttontext:"&larr;",tooltiptext:"arrow-left",action:function(){return this.$editor().wrapSelection("inserthtml","&larr;")}}),t("arrow-right",{buttontext:"&rarr;",tooltiptext:"arrow-right",action:function(){return this.$editor().wrapSelection("inserthtml","&rarr;")}}),t("arrow-left-right",{buttontext:"&harr;",tooltiptext:"arrow-left-right",action:function(){return this.$editor().wrapSelection("inserthtml","&harr;")}}),t("sdot",{buttontext:"&sdot;",tooltiptext:"sdot",action:function(){return this.$editor().wrapSelection("inserthtml","&sdot;")}}),t("asymp",{buttontext:"&asymp;",tooltiptext:"asymp",action:function(){return this.$editor().wrapSelection("inserthtml","&asymp;")}}),t("radic",{buttontext:"&radic;",tooltiptext:"radic",action:function(){return this.$editor().wrapSelection("inserthtml","&radic;")}}),t("prop",{buttontext:"&prop;",tooltiptext:"prop",action:function(){return this.$editor().wrapSelection("inserthtml","&prop;")}}),t("alpha",{buttontext:"&alpha;",tooltiptext:"alpha",action:function(){return this.$editor().wrapSelection("inserthtml","&alpha;")}}),t("beta",{buttontext:"&beta;",tooltiptext:"beta",action:function(){return this.$editor().wrapSelection("inserthtml","&beta;")}}),t("gamma",{buttontext:"&gamma;",tooltiptext:"gamma",action:function(){return this.$editor().wrapSelection("inserthtml","&gamma;")}}),t("delta",{buttontext:"&delta;",tooltiptext:"delta",action:function(){return this.$editor().wrapSelection("inserthtml","&delta;")}}),t("lambda",{buttontext:"&lambda;",tooltiptext:"lambda",action:function(){return this.$editor().wrapSelection("inserthtml","&lambda;")}}),t("mu",{buttontext:"&mu;",tooltiptext:"mu",action:function(){return this.$editor().wrapSelection("inserthtml","&mu;")}}),t("pi",{buttontext:"&pi;",tooltiptext:"pi",action:function(){return this.$editor().wrapSelection("inserthtml","&pi;")}}),t("rho",{buttontext:"&rho;",tooltiptext:"rho",action:function(){return this.$editor().wrapSelection("inserthtml","&rho;")}}),t("omega",{buttontext:"&omega;",tooltiptext:"omega",action:function(){return this.$editor().wrapSelection("inserthtml","&omega;")}}),t("Omega",{buttontext:"&Omega;",tooltiptext:"Omega",action:function(){return this.$editor().wrapSelection("inserthtml","&Omega;")}}),t("subscript",{iconclass:"fa fa-subscript",tooltiptext:"Subscript",action:function(){return this.$editor().wrapSelection("subscript",null)},activeState:function(){return this.$editor().queryCommandState("subscript")}}),t("superscript",{iconclass:"fa fa-superscript",tooltiptext:"Superscript",action:function(){return this.$editor().wrapSelection("superscript",null)},activeState:function(){return this.$editor().queryCommandState("superscript")}}),e}])}]).run(["Auth","$location","$window",function(t,e,o){var n=["/","/register","/forgot-password"],r=["/author","/edit-exam","/edit-oral-exam"],i=["/admin"],s=t.tryGetUser(),a=!1,l=!1,u=!1;s&&(a=Boolean(s.group_id),l=Boolean(2===s.group_id),u=Boolean(3===s.group_id));var c=e.path();n.indexOf(c)>-1&&a&&s.remember_user&&o.location.replace("/learn/overview"),r.indexOf(c)>-1&&!u&&!l&&o.location.replace("/403"),i.indexOf(c)>-1&&!l&&o.location.replace("/403")}]);var AdminController=function(){function t(t){t.setTitleAndNav("Admin | Crucio","Admin")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("admincomponent",{templateUrl:"app/admin/admin.html",controller:AdminController});var AdminActivityController=function(){function t(t,e,o,n){var r=this;this.API=o,t.setTitleAndNav("Statistik | Crucio","Admin"),this.updateActivity=!1,this.showActivity={result:!0,login:!0,register:!0,comment:!0,examNew:!0,examUpdate:!0},n(function(){r.updateActivity&&r.loadActivity()},2500),this.loadActivity()}return t.$inject=["Page","Auth","API","$interval"],t.prototype.loadActivity=function(){var t=this,e={result:0|this.showActivity.result,login:0|this.showActivity.login,register:0|this.showActivity.register,comment:0|this.showActivity.comment,examNew:0|this.showActivity.examNew,examUpdate:0|this.showActivity.examUpdate};this.API.get("stats/activities",e,!0).then(function(e){t.activities=e.data.activities})},t}();angular.module("crucioApp").component("adminactivitycomponent",{templateUrl:"app/admin/activity/activity.html",controller:AdminActivityController});var AdminStatsController=function(){function t(t,e){var o=this;this.API=e,this.API.get("stats/summary").then(function(t){o.stats=t.data.stats})}return t.$inject=["Auth","API"],t}();angular.module("crucioApp").component("adminstatscomponent",{templateUrl:"app/admin/stats/stats.html",controller:AdminStatsController});var AdminToolsController=function(){function t(t,e){this.API=e}return t.$inject=["Auth","API"],t.prototype.changeSemester=function(t){var e={difference:t};this.API.put("users/change-semester",e).then(function(t){alert(t.data.status)})},t.prototype.removeTestAccount=function(){this.API.delete("users/test-account").then(function(t){alert(t.data.status)})},t}();angular.module("crucioApp").component("admintoolscomponent",{templateUrl:"app/admin/tools/tools.html",controller:AdminToolsController});var DeleteUserModalController=function(){function t(t,e,o){this.API=t,this.user=e,this.$uibModalInstance=o}return t.$inject=["API","user","$uibModalInstance"],t.prototype.deleteUser=function(){this.API.delete("users/"+this.user.user_id),this.$uibModalInstance.close()},t}();angular.module("crucioApp").controller("deleteUserModalController",DeleteUserModalController);var AdminUsersController=function(){function t(t,e,o){var n=this;this.API=e,this.$uibModal=o,this.user=t.getUser(),this.userSearch={},this.API.get("users/distinct").then(function(t){n.distinctGroups=t.data.groups,n.distinctSemesters=t.data.semesters,n.distinctGroupsPerId={};for(var e=0,o=n.distinctGroups;e<o.length;e++){var r=o[e];n.distinctGroupsPerId[r.group_id]=r.name}}),this.loadUsers()}return t.$inject=["Auth","API","$uibModal"],t.prototype.loadUsers=function(){var t=this,e={semester:this.userSearch.semester,group_id:this.userSearch.group,query:this.userSearch.query,limit:100};this.API.get("users",e).then(function(e){t.users=e.data.users})},t.prototype.changeGroup=function(t){var e=this.users[t].user_id,o=this.users[t].group_id;o=o%this.distinctGroups.length+1,this.users[t].group_id=o;for(var n=0,r=this.distinctGroups;n<r.length;n++){var i=r[n];if(i.group_id===o){this.users[t].group_name=i.name;break}}var s={group_id:o};this.API.put("users/"+e+"/group",s,!0)},t.prototype.isToday=function(t,e){void 0===e&&(e=0);var o=new Date,n=o-36e5*e,r=new Date(n),i=new Date(1e3*t);return r.toDateString()===i.toDateString()},t.prototype.deleteUserModal=function(t){var e=this,o=this.$uibModal.open({templateUrl:"deleteUserModalContent.html",controller:"deleteUserModalController",controllerAs:"$ctrl",resolve:{user:function(){return e.users[t]}}});o.result.then(function(){this.users.splice(t,1)},function(){})},t}();angular.module("crucioApp").component("adminuserscomponent",{templateUrl:"app/admin/users/users.html",controller:AdminUsersController});var AdminWhitelistController=function(){function t(t,e){var o=this;this.API=e,this.API.get("whitelist").then(function(t){o.whitelist=t.data.whitelist})}return t.$inject=["Auth","API"],t.prototype.addMail=function(){var t=this.newWhitelistEmail;if(t){this.whitelist.push({mail_address:t,username:""});var e={email:t};this.API.post("whitelist",e)}},t.prototype.removeMail=function(t){var e=this.whitelist[t].mail_address;e&&(this.whitelist.splice(t,1),this.API.delete("whitelist/"+e))},t}();angular.module("crucioApp").component("adminwhitelistcomponent",{templateUrl:"app/admin/whitelist/whitelist.html",controller:AdminWhitelistController});var AuthorController=function(){function t(t){t.setTitleAndNav("Autor | Crucio","Author")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("authorcomponent",{templateUrl:"app/author/author.html",controller:AuthorController});var AuthorAdivcesController=function(){function t(){}return t}();angular.module("crucioApp").component("authoradvicescomponent",{templateUrl:"app/author/advices/advices.html",controller:AuthorAdivcesController});var AuthorCommentsController=function(){function t(t,e){var o=this;this.API=e,this.user=t.getUser(),this.commentSearch={author:this.user},this.API.get("exams/distinct").then(function(t){o.distinctAuthors=t.data.authors}),this.loadComments()}return t.$inject=["Auth","API"],t.prototype.loadComments=function(){var t=this,e={author_id:this.commentSearch.author&&this.commentSearch.author.user_id,query:this.commentSearch.query,limit:100};this.API.get("comments/author",e).then(function(e){t.comments=e.data.comments,t.questionsByComment=[];for(var o=0,n=t.comments;o<n.length;o++){for(var r=n[o],i=-1,s=0;s<t.questionsByComment.length;s++)if(t.questionsByComment[s][0].question===r.question){i=s;break}i>0?t.questionsByComment[i].push(r):t.questionsByComment.push([r])}t.questionsByComment.sort(function(t,e){return e[0].date-t[0].date})})},t}();angular.module("crucioApp").component("authorcommentscomponent",{templateUrl:"app/author/comments/comments.html",controller:AuthorCommentsController});var DeleteExamModalController=function(){function t(t,e,o,n){this.API=t,this.examId=e,this.$location=o,this.$uibModalInstance=n}return t.$inject=["API","examId","$location","$uibModalInstance"],t.prototype.deleteExam=function(){var t=this;this.API.delete("exams/"+this.examId).then(function(){t.$uibModalInstance.close(),t.$location.url("/author/exams")})},t}();angular.module("crucioApp").controller("deleteExamModalController",DeleteExamModalController);var EditExamController=function(){function t(t,e,o,n,r,i,s,a){var l=this;this.API=o,this.FileUploader=n,this.$location=i,this.$uibModal=a,t.setTitleAndNav("Klausur | Crucio","Author"),this.user=e.getUser(),this.examId=s.examId,this.openQuestionId=parseInt(s.questionId,0),this.openQuestionIndex=-1,this.numberChanged=-3,this.uploader=new n({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(t,e){l.exam.file_name=e.upload_name},this.uploaderArray=[],this.exam_types=["Erstklausur","Wiederholungsklausur","Leistungskontrolle","Fragensammlung","Testat","Sonstiges"],r.$watch(function(){return l.exam},function(){l.hasChanged=l.numberChanged>0,l.numberChanged+=1},!0),r.$watch(function(){return l.questions},function(){l.hasChanged=l.numberChanged>0,l.numberChanged+=1},!0),r.$on("$locationChangeStart",function(t){if(l.hasChanged){var e=confirm("Die Änderungen an der Klausur bleiben dann ungespeichert. Wirklich verlassen?");e||t.preventDefault()}}),this.API.get("subjects").then(function(t){l.subjectList=t.data.subjects,l.subjectListPerId={},l.categoryListPerId={};for(var e=0,o=l.subjectList;e<o.length;e++){var n=o[e];l.subjectListPerId[n.subject_id]=n.subject,l.categoryListPerId[n.subject_id]=n.categories,l.categoryListPerId[n.subject_id].unshift({category_id:0,category:"Sonstiges"})}}),this.loadExam()}return t.$inject=["Page","Auth","API","FileUploader","$scope","$location","$stateParams","$uibModal"],t.prototype.loadExam=function(){var t=this;this.API.get("exams/"+this.examId).then(function(e){t.exam=e.data.exam,t.questions=e.data.questions;for(var o=0;o<t.questions.length;o++)if(t.questions[o].question_id===t.openQuestionId){t.openQuestionIndex=o;break}t.remakeUploaderArray(),0===t.questions.length&&t.addQuestion(!1),t.ready=!0})},t.prototype.remakeUploaderArray=function(){var t=this;this.uploaderArray=[];for(var e=0;e<this.questions.length;e++){var o=new this.FileUploader({url:"/api/v1/file/upload",formData:e});o.onSuccessItem=function(e,o){var n=e.formData;t.questions[n].question_image_url=o.upload_name},this.uploaderArray.push(o)}},t.prototype.addQuestion=function(t){var e={category_id:0,question:"",type:5,correct_answer:0,answers:["","","","","",""]};this.questions.push(e),t&&(this.openQuestionIndex=this.questions.length-1),this.remakeUploaderArray()},t.prototype.deleteQuestion=function(t){var e=this.questions[t].question_id;e&&this.API.delete("questions/"+e),this.questions.splice(t,1),this.openQuestionIndex=Math.min(this.openQuestionIndex,this.questions.length-1),this.remakeUploaderArray(),this.questions||this.addQuestion(!0)},t.prototype.saveExam=function(){var t=this.exam.subject_id&&this.exam.semester>0&&this.exam.semester<=50&&this.exam.date;if(t){this.isSaving=!0,this.API.put("exams/"+this.examId,this.exam).then(function(t){t.data.status||alert("Fehler beim Speichern der Klausur.")});for(var e=function(t){var e=t.question||t.question_id;if(e){t.explanation=t.explanation||"",t.question_image_url=t.question_image_url||"";var n={exam_id:o.exam.exam_id,user_id_added:o.user.user_id,category_id:t.category_id,question:t.question,type:t.type,answers:t.answers,correct_answer:t.correct_answer,explanation:t.explanation,question_image_url:t.question_image_url};t.question_id?o.API.put("questions/"+t.question_id,n):o.API.post("questions",n).then(function(e){t.question_id=e.data.question_id})}},o=this,n=0,r=this.questions;n<r.length;n++){var i=r[n];e(i)}this.hasChanged=!1,this.numberChanged=0,this.isSaving=!1}else alert("Es fehlen noch allgemeine Infos zur Klausur.")},t.prototype.deleteExamModal=function(){var t=this;this.$uibModal.open({templateUrl:"deleteExamModalContent.html",controller:"deleteExamModalController",controllerAs:"$ctrl",resolve:{examId:function(){return t.examId}}})},t}();angular.module("crucioApp").component("editexamcomponent",{templateUrl:"app/author/edit-exam/edit-exam.html",controller:EditExamController});var DeleteOralExamModalController=function(){function t(t,e,o,n){this.API=t,this.oralExamId=e,this.$location=o,this.$uibModalInstance=n}return t.$inject=["API","oralExamId","$location","$uibModalInstance"],t.prototype.deleteOralExam=function(){var t=this;this.API.delete("oral_exams/"+this.oralExamId).then(function(){t.$uibModalInstance.close(),t.$location.url("/author/oral-exams")})},t}();angular.module("crucioApp").controller("deleteOralExamModalController",DeleteOralExamModalController);var EditOralExamController=function(){function t(t,e,o,n,r,i,s,a){var l=this;this.API=o,this.FileUploader=n,this.$location=i,this.$uibModal=a,t.setTitleAndNav("Mündliche Prüfung | Crucio","Author"),this.user=e.getUser(),this.oralExamId=s.oralExamId,this.numberChanged=-1,this.uploader=new n({url:"/api/v1/file/upload"}),this.uploader.onSuccessItem=function(t,e){l.oralExam.filename=e.upload_name},r.$watch(function(){return l.oralExam},function(){l.hasChanged=l.numberChanged>0,l.numberChanged+=1},!0),r.$on("$locationChangeStart",function(t){if(l.hasChanged){var e=confirm("Die Änderungen an der Prüfung bleiben dann ungespeichert. Wirklich verlassen?");e||t.preventDefault()}}),this.loadOralExam()}return t.$inject=["Page","Auth","API","FileUploader","$scope","$location","$stateParams","$uibModal"],t.prototype.loadOralExam=function(){var t=this;this.API.get("oral_exams/"+this.oralExamId).then(function(e){t.oralExam=e.data.oral_exam,t.ready=!0}),this.ready=!0},t.prototype.saveOralExam=function(){var t=this,e=this.oralExam.semester>=0&&this.oralExam.semester<=1;e?(this.isSaving=!0,this.API.put("oral_exams/"+this.oralExamId,this.oralExam).then(function(e){e.data.status||alert("Fehler beim Speichern der Klausur."),t.hasChanged=!1,t.numberChanged=0,t.isSaving=!1})):alert("Es fehlen noch allgemeine Infos zur Klausur.")},t.prototype.deleteOralExamModal=function(){var t=this;this.$uibModal.open({templateUrl:"deleteOralExamModalContent.html",controller:"deleteOralExamModalController",controllerAs:"$ctrl",resolve:{oralExamId:function(){return t.oralExamId}}})},t}();angular.module("crucioApp").component("editoralexamcomponent",{templateUrl:"app/author/edit-oral-exam/edit-oral-exam.html",controller:EditOralExamController});var AuthorExamsController=function(){function t(t,e,o){var n=this;this.API=e,this.$location=o,this.user=t.getUser(),this.examSearch={author:this.user},this.API.get("exams/distinct").then(function(t){n.distinctSemesters=t.data.semesters,n.distinctAuthors=t.data.authors,n.distinctSubjects=t.data.subjects}),this.API.get("subjects").then(function(t){n.subjectList=t.data.subjects}),this.loadExams()}return t.$inject=["Auth","API","$location"],t.prototype.loadExams=function(){var t=this,e={subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,author_id:this.examSearch.author&&this.examSearch.author.user_id,semester:this.examSearch.semester,query:this.examSearch.query,limit:200,showEmpty:!0};this.API.get("exams",e).then(function(e){t.exams=e.data.exams})},t.prototype.newExam=function(){var t=this,e={subject_id:1,user_id_added:this.user.user_id,sort:"Erstklausur"};this.API.post("exams",e).then(function(e){t.$location.path("/edit-exam").search("examId",e.data.exam_id)})},t}();angular.module("crucioApp").component("authorexamscomponent",{templateUrl:"app/author/exams/exams.html",controller:AuthorExamsController});var AuthorOralExamsController=function(){function t(t,e,o){var n=this;this.API=e,this.$location=o,this.user=t.getUser(),this.oralExamSearch={},this.API.get("oral_exams/distinct").then(function(t){n.distinctOralYears=t.data.years}),this.loadOralExams()}return t.$inject=["Auth","API","$location"],t.prototype.loadOralExams=function(){var t=this,e={semester:this.oralExamSearch.semester,year:this.oralExamSearch.year,query:this.oralExamSearch.query,limit:200};this.API.get("oral_exams",e).then(function(e){t.oralExams=e.data.oral_exams})},t.prototype.newOralExam=function(){var t=this,e={examiner_count:3,semester:0,year:2016};this.API.post("oral_exams",e).then(function(e){t.$location.path("/edit-oral-exam").search("oralExamId",e.data.oral_exam_id)})},t}();angular.module("crucioApp").component("authororalexamscomponent",{templateUrl:"app/author/oral-exams/oral-exams.html",controller:AuthorOralExamsController});var AuthorSubjectsController=function(){function t(t){var e=this;this.API=t,this.API.get("subjects").then(function(t){e.subjectList=t.data.subjects})}return t.$inject=["API"],t}();angular.module("crucioApp").component("authorsubjectscomponent",{templateUrl:"app/author/subjects/subjects.html",controller:AuthorSubjectsController});var ModalInstanceController=function(){function t(t,e){this.data=t,this.$uibModalInstance=e}return t.$inject=["data","$uibModalInstance"],t}();angular.module("crucioApp").controller("ModalInstanceController",ModalInstanceController);var TimeagoController=function(){function t(){}return t.prototype.$onInit=function(){function t(t,e){var n=o.numbers&&o.numbers[e]||e;return t.replace(/%d/i,n)}function e(t){return t.replace(/^\s+|\s+$/g,"")}var o={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren",wordSeparator:" ",numbers:[]},n=this.datetime,r=(new Date).getTime(),i=Math.abs(r-n),s=i/1e3,a=s/60,l=a/60,u=l/24,c=u/365,h=o.prefixAgo,m=o.suffixAgo,d=s<45&&t(o.seconds,Math.round(s))||s<90&&t(o.minute,1)||a<45&&t(o.minutes,Math.round(a))||a<90&&t(o.hour,1)||l<24&&t(o.hours,Math.round(l))||l<42&&t(o.day,1)||u<30&&t(o.days,Math.round(u))||u<45&&t(o.month,1)||u<365&&t(o.months,Math.round(u/30))||c<1.5&&t(o.year,1)||t(o.years,Math.round(c));this.result=e([h,d,m].join(o.wordSeparator))},t}();angular.module("crucioApp").component("timeago",{template:"<span>{{ $ctrl.result }}</span>",controller:TimeagoController,bindings:{datetime:"<"}});var NavbarController=function(){function t(t,e){this.Page=e,this.Auth=t,this.user=t.getUser()}return t.$inject=["Auth","Page"],t.prototype.logout=function(){this.Auth.logout()},t}();angular.module("crucioApp").component("navbar",{templateUrl:"app/components/navbar/navbar.html",controller:NavbarController});var ErrorController=function(){function t(t){t.setTitleAndNav("Fehler | Crucio","")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("error403component",{templateUrl:"app/error/403.html",controller:ErrorController}),angular.module("crucioApp").component("error404component",{templateUrl:"app/error/404.html",controller:ErrorController}),angular.module("crucioApp").component("error500component",{templateUrl:"app/error/500.html",controller:ErrorController}),angular.module("crucioApp").filter("cut",Cut);var HelpController=function(){function t(t,e,o,n,r){var i=this;this.API=o,e.setTitleAndNav("Hilfe | Crucio",""),this.user=t.getUser(),this.question_id=r.questionId,this.subject=r.s,this.question_id&&this.API.get("questions/"+this.question_id).then(function(t){i.question=t.data.question})}return t.$inject=["Auth","Page","API","$location","$stateParams"],t.prototype.sendMail=function(){var t=this,e=this.text;if(e)if(this.isWorking=!0,this.question_id){var o={text:this.text,name:this.user.username,email:this.user.email,question_id:this.question_id,author:this.question.username,question:this.question.question,exam_id:this.question.exam_id,subject:this.question.subject,date:this.question.date,author_email:this.question.email,mail_subject:this.subject};this.API.post("contact/send-mail-question",o).then(function(){t.isWorking=!1,t.emailSend=!0})}else{var o={text:this.text,name:this.user.username,email:this.user.email};this.API.post("contact/send-mail",o).then(function(){t.isWorking=!1,t.emailSend=!0})}},t}();angular.module("crucioApp").component("helpcomponent",{templateUrl:"app/help/help.html",controller:HelpController});var LearnController=function(){function t(t){t.setTitleAndNav("Lernen | Crucio","Learn")}return t.$inject=["Page"],t}();angular.module("crucioApp").component("learncomponent",{templateUrl:"app/learn/learn.html",controller:LearnController});var AnalysisController=function(){function t(t,e,o,n){function r(t,e){return Math.floor(Math.random()*(e-t+1))+t}var i=this;this.API=o,t.setTitleAndNav("Analyse | Crucio","Learn"),this.user=e.getUser();for(var s=0,a=n.get().list;s<a.length;s++){var l=a[s];if(!l.mark_answer&&l.type>1&&l.given_result>0){var u=l.correct_answer===l.given_result?1:0;0!==l.correct_answer&&1!==l.question.type||(u=-1);var c={correct:u,given_result:l.given_result,question_id:l.question_id,user_id:this.user.user_id};this.API.post("results",c)}}this.random=r(0,1e3),this.examId=n.get().exam_id,this.workedCollection=n.getWorked(),this.count=n.analyseCount(),this.examId&&this.API.get("exams/"+this.examId).then(function(t){i.exam=t.data.exam})}return t.$inject=["Page","Auth","API","Collection"],t.prototype.showCorrectAnswerClicked=function(t){this.workedCollection[t].show_correct_answer=1},t}();angular.module("crucioApp").component("analysiscomponent",{templateUrl:"app/learn/analysis/analysis.html",controller:AnalysisController});var LearnCommentsController=function(){function t(t,e){this.API=e,this.user=t.getUser(),this.commentSearch={},this.loadComments()}return t.$inject=["Auth","API"],t.prototype.loadComments=function(){var t=this,e={query:this.commentSearch.query,user_id:this.user.user_id};this.API.get("comments",e).then(function(e){t.comments=e.data.comments,t.questionsByComment={};for(var o=0,n=t.comments;o<n.length;o++){var r=n[o];t.questionsByComment[r.question]=t.questionsByComment[r.question]||[],t.questionsByComment[r.question].push(r)}})},t}();angular.module("crucioApp").component("learncommentscomponent",{templateUrl:"app/learn/comments/comments.html",controller:LearnCommentsController});var ExamController=function(){function t(t,e,o,n,r,i,s,a,l,u){var c=this;this.API=o,this.Collection=n,this.$location=r,this.$document=l,this.$uibModal=i,t.setTitleAndNav("Klausur | Crucio","Learn"),this.user=e.getUser(),this.examId=s.examId,this.currentIndex=0,l.on("scroll",function(){for(var t=l.scrollTop(),e=function(e){var o=angular.element(u.document.getElementById("id"+e));return o.prop("offsetTop")>t&&(a(function(){c.currentIndex=Math.max(e-1,0)},0),!0)},o=0;o<c.Collection.get().list.length&&!e(o);o++);}),this.loadExam()}return t.$inject=["Page","Auth","API","Collection","$location","$uibModal","$stateParams","$timeout","$document","$window"],t.prototype.loadExam=function(){var t=this;this.API.get("exams/"+this.examId).then(function(e){t.exam=e.data.exam,t.length=e.data.questions.length,t.Collection.set({type:"exam",exam_id:t.examId,list:e.data.questions})})},t.prototype.handExam=function(){this.$location.path("/analysis").search("id",null)},t.prototype.openImageModal=function(t){this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"$ctrl",resolve:{data:function(){return t}}})},t}();angular.module("crucioApp").component("examcomponent",{templateUrl:"app/learn/exam/exam.html",controller:ExamController});var LearnExamsController=function(){function t(t,e,o,n,r,i){var s=this;this.API=e,this.Collection=o,this.$location=r,this.user=t.getUser(),this.examSearch={semester:this.user.semester},this.API.get("exams/distinct",{visibility:1}).then(function(t){s.distinctSemesters=t.data.semesters,s.distinctSubjects=t.data.subjects}),this.loadExams()}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadExams=function(){var t=this,e={user_id:this.user.user_id,semester:this.examSearch.semester,subject_id:this.examSearch.subject&&this.examSearch.subject.subject_id,query:this.examSearch.query,visibility:1};this.API.get("exams",e).then(function(e){t.exams=e.data.exams})},t.prototype.learnExam=function(t){var e=this,o={random:!1};this.Collection.prepareExam(t,o).then(function(t){e.$location.path("/question").search("questionId",t.list[0].question_id)})},t.prototype.resetExam=function(t){t.answered_questions=0,this.API.delete("results/"+this.user.user_id+"/"+t.exam_id,!0)},t}();angular.module("crucioApp").component("learnexamscomponent",{templateUrl:"app/learn/exams/exams.html",controller:LearnExamsController});var LearnOralExamsController=function(){function t(t,e,o,n,r,i){var s=this;this.API=e,this.user=t.getUser(),this.oralExamSearch={semester:this.user.semester<=4?0:1},this.API.get("oral_exams/distinct",{visibility:1}).then(function(t){s.distinctOralSemesters=t.data.semesters,s.distinctOralYears=t.data.years})}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.searchOralExams=function(){var t=this;if(this.oralExams=[],this.hasSearched=!1,this.oralExamSearch.query){var e={semester:this.oralExamSearch.semester,year:this.oralExamSearch.year,query:this.oralExamSearch.query,limit:200};this.API.get("oral_exams",e,!0).then(function(e){t.oralExams=e.data.oral_exams,t.hasSearched=!0})}},t}();angular.module("crucioApp").component("learnoralexamscomponent",{templateUrl:"app/learn/oral-exams/oral-exams.html",controller:LearnOralExamsController});var LearnOverviewController=function(){function t(t,e,o,n,r,i){var s=this;this.API=e,this.Collection=o,this.$location=r,this.user=t.getUser(),this.API.get("exams/distinct",{visibility:1}).then(function(t){s.distinctSemesters=t.data.semesters,s.distinctSubjects=t.data.subjects}),this.loadOverview()}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadOverview=function(){var t=this,e={limit:12};this.API.get("exams/abstract/"+this.user.user_id,e).then(function(e){t.abstractExams=e.data.exams,t.ready=1})},t.prototype.learnExam=function(t){var e=this,o={random:!1};this.Collection.prepareExam(t,o).then(function(t){e.$location.path("/question").search("questionId",t.list[0].question_id)})},t.prototype.resetExam=function(t){t.answered_questions=0,this.API.delete("results/"+this.user.user_id+"/"+t.exam_id,!0)},t}();angular.module("crucioApp").component("learnoverviewcomponent",{templateUrl:"app/learn/overview/overview.html",controller:LearnOverviewController});var QuestionController=function(){function t(t,e,o,n,r,i,s){if(this.Auth=t,this.API=o,this.Collection=n,this.$uibModal=s,e.setTitleAndNav("Frage | Crucio","Learn"),this.user=t.getUser(),this.questionId=Number(r.questionId),this.resetSession=Boolean(r.resetSession),this.commentsCollapsed=Boolean(this.user.showComments),this.questionId||(alert("Fehler: Konnte keine Frage finden."),i.location.replace("/learn/overview")),this.noAnswer=!0,this.showExplanation=!1,this.resetSession)this.index=-1,delete this.collection,n.remove(),this.questionData={};else if(this.collection=this.Collection.get(),this.index=this.Collection.getIndexOfQuestion(this.questionId),this.index>-1){var a=this.collection.list;this.questionData=this.Collection.getQuestionData(this.index),this.length=a.length,this.preQuestionId=this.index>0?a[this.index-1].question_id:this.questionId,this.postQuestionId=this.index<this.length-1?a[this.index+1].question_id:this.questionId}this.loadQuestion()}return t.$inject=["Auth","Page","API","Collection","$stateParams","$window","$uibModal"],t.prototype.loadQuestion=function(){var t=this;this.API.get("questions/"+this.questionId+"/user/"+this.user.user_id).then(function(e){t.question=e.data.question,t.comments=e.data.comments,t.tags=[],e.data.tags&&(t.tags=e.data.tags.split(",").map(function(t){return{text:t}})),t.checkedAnswer=t.questionData.givenAnswer,t.questionData.mark_answer&&t.markAnswer(t.questionData.givenAnswer)})},t.prototype.updateTags=function(t){var e=this.tags.map(function(t){return t.text}).join(","),o={tags:e,question_id:this.questionId,user_id:this.user.user_id
};this.API.post("tags",o,!0)},t.prototype.showSolution=function(){var t=this.question.correct_answer;this.checkedAnswer=t;var e=t===this.questionData.givenAnswer?1:0;0!==t&&1!==this.question.type||(e=-1);var o={correct:e,question_id:this.questionId,user_id:this.user.user_id,given_result:this.questionData.givenAnswer};this.API.post("results",o,!0),this.Collection.saveMarkAnswer(this.index),this.markAnswer(this.questionData.givenAnswer)},t.prototype.saveAnswer=function(t){this.questionData.givenAnswer=t,this.Collection.saveAnswer(this.index,this.questionData.givenAnswer)},t.prototype.markAnswer=function(t){this.isAnswerGiven=!0;var e=this.question.type;e>1&&(this.correctAnswer=this.question.correct_answer,this.checkedAnswer=t>0?t:this.correctAnswer,this.isAnswerRight=t===this.correctAnswer,this.isAnswerWrong=t!==this.correctAnswer,t!==this.correctAnswer&&(this.wrongAnswer=t))},t.prototype.addComment=function(){var t=this,e=+new Date/1e3,o={comment:this.commentText,question_id:this.questionId,reply_to:0,username:this.user.username,date:e};this.API.post("comments/"+this.user.user_id,o).then(function(e){o.voting=0,o.user_voting=0,o.comment_id=e.data.comment_id,t.comments.push(o),t.commentText=""})},t.prototype.deleteComment=function(t){var e=this.comments[t].comment_id;this.API.delete("comments/"+e),this.comments.splice(t,1)},t.prototype.changeUserVoting=function(t,e){t.user_voting=Math.min(Math.max(t.user_voting+e,-1),1);var o={user_voting:t.user_voting};this.API.post("comments/"+t.comment_id+"/user/"+this.user.user_id,o,!0)},t.prototype.openImageModal=function(){var t=this;this.$uibModal.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceController",controllerAs:"$ctrl",resolve:{data:function(){return t.question.question_image_url}}})},t}();angular.module("crucioApp").component("questioncomponent",{templateUrl:"app/learn/question/question.html",controller:QuestionController});var LearnSearchController=function(){function t(t,e){var o=this;this.API=e,this.user=t.getUser(),this.questionSearch={semester:this.user.semester},this.API.get("exams/distinct",{visibility:1}).then(function(t){o.distinctSemesters=t.data.semesters,o.distinctSubjects=t.data.subjects}),this.limit=100}return t.$inject=["Auth","API"],t.prototype.searchQuestion=function(){var t=this;if(this.searchResults=[],this.hasSearched=!1,this.questionSearch.query){this.showSpinner=!0;var e={query:this.questionSearch.query,subject_id:this.questionSearch.subject&&this.questionSearch.subject.subject_id,semester:this.questionSearch.semester,visibility:1,limit:this.limit};this.API.get("questions",e,!0).then(function(e){t.searchResults=e.data.result,t.showSpinner=!1,t.hasSearched=!0})}},t}();angular.module("crucioApp").component("learnsearchcomponent",{templateUrl:"app/learn/search/search.html",controller:LearnSearchController});var StatisticController=function(){function t(t,e){e.setTitleAndNav("Statistik | Crucio","Learn"),this.user=t.getUser()}return t.$inject=["Auth","Page"],t}();angular.module("crucioApp").component("statisticcomponent",{templateUrl:"app/learn/statistic/statistic.html",controller:StatisticController});var LearnSubjectsController=function(){function t(t,e,o,n,r,i){var s=this;this.API=e,this.Collection=o,this.$location=r,this.user=t.getUser(),this.selection={},this.selectedQuestionNumber=0,this.numberQuestionsInSelection=0,this.sliderOptions={floor:0,ceil:this.numberQuestionsInSelection},i(function(){n.$broadcast("rzSliderForceRender")}),this.API.get("exams/distinct",{visibility:1}).then(function(t){s.distinctSemesters=t.data.semesters,s.distinctSubjects=t.data.subjects}),this.API.get("subjects").then(function(t){s.subjectList=t.data.subjects})}return t.$inject=["Auth","API","Collection","$scope","$location","$timeout"],t.prototype.loadNumberQuestions=function(){var t=this,e={selection:this.selection};this.API.get("questions/count",e,!0).then(function(e){t.numberQuestionsInSelection=e.data.count;var o=Math.min(t.numberQuestionsInSelection,500);t.sliderOptions={floor:0,ceil:o},t.selectedQuestionNumber||(t.selectedQuestionNumber=50),t.selectedQuestionNumber=Math.min(t.selectedQuestionNumber,t.numberQuestionsInSelection)})},t.prototype.learnSubjects=function(){var t=this,e={selection:this.selection,limit:this.selectedQuestionNumber};this.Collection.prepareSubjects(e).then(function(e){t.$location.path("/question").search("questionId",e.list[0].question_id)})},t}();angular.module("crucioApp").component("learnsubjectscomponent",{templateUrl:"app/learn/subjects/subjects.html",controller:LearnSubjectsController});var LearnTagsController=function(){function t(t,e){this.API=e,this.user=t.getUser(),this.loadTags()}return t.$inject=["Auth","API"],t.prototype.loadTags=function(){var t=this,e={user_id:this.user.user_id};this.API.get("tags",e).then(function(e){t.tags=e.data.tags,t.distinctTags=[];for(var o=0,n=t.tags;o<n.length;o++)for(var r=n[o],i=0,s=r.tags.split(",");i<s.length;i++){var a=s[i];t.distinctTags.includes(a)||t.distinctTags.push(a)}t.questionsByTag={};for(var l=0,u=t.distinctTags;l<u.length;l++){var c=u[l];t.questionsByTag[c]=[];for(var h=0,m=t.tags;h<m.length;h++)for(var r=m[h],d=0,p=r.tags.split(",");d<p.length;d++){var a=p[d];c===a&&t.questionsByTag[c].push(r)}}})},t}();angular.module("crucioApp").component("learntagscomponent",{templateUrl:"app/learn/tags/tags.html",controller:LearnTagsController});var API=function(){function t(t){this.$http=t,this.base="api/v1/"}return t.$inject=["$http"],t.prototype.sanitize=function(t){return t.email=t.email&&t.email.replace("@","(@)"),t},t.prototype.get=function(t,e,o){return void 0===e&&(e={}),void 0===o&&(o=!1),this.$http.get(this.base+t,{params:this.sanitize(e)})},t.prototype.post=function(t,e,o){return void 0===o&&(o=!1),this.$http.post(this.base+t,this.sanitize(e))},t.prototype.put=function(t,e,o){return void 0===o&&(o=!1),this.$http.put(this.base+t,this.sanitize(e))},t.prototype.delete=function(t,e,o){return void 0===e&&(e={}),void 0===o&&(o=!1),this.$http.delete(this.base+t,{params:this.sanitize(e)})},t}();angular.module("crucioApp").service("API",API);var Auth=function(){function t(t,e){this.$window=e,this.$cookies=t}return t.$inject=["$cookies","$window"],t.prototype.getUser=function(){return this.tryGetUser(),this.user||this.$window.location.replace("/"),this.user},t.prototype.tryGetUser=function(){return angular.isUndefined(this.user)&&angular.isDefined(this.$cookies.getObject("CrucioUser"))&&this.setUser(this.$cookies.getObject("CrucioUser")),this.user},t.prototype.logout=function(){this.$cookies.remove("CrucioUser"),this.$window.location.assign(this.$window.location.origin)},t.prototype.setUser=function(t,e){if(void 0===e&&(e=!1),this.user=t,e||angular.isDefined(this.$cookies.getObject("CrucioUser"))){var o=new Date;o.setDate(o.getDate()+21),this.$cookies.putObject("CrucioUser",this.user,{expires:o})}this.user.remember_me||this.$cookies.remove("CrucioUser")},t}();angular.module("crucioApp").service("Auth",Auth);var Collection=function(){function t(t){this.API=t}return t.$inject=["API"],t.prototype.get=function(){return angular.isUndefined(this.collection)&&angular.isDefined(sessionStorage.crucioCollection)&&this.set(angular.fromJson(sessionStorage.crucioCollection)),this.collection},t.prototype.set=function(t){this.collection=t,sessionStorage.crucioCollection=angular.toJson(t)},t.prototype.remove=function(){delete this.collection,sessionStorage.removeItem("crucioCollection")},t.prototype.getWorked=function(){return this.get(),this.collection.list.filter(function(t){return t.given_result})},t.prototype.analyseCount=function(){for(var t=this.getWorked(),e={correct:0,wrong:0,seen:0,solved:0,free:0,no_answer:0,all:this.collection.list.length,worked:t.length},o=0,n=t;o<n.length;o++){var r=n[o];r.correct_answer===r.given_result&&r.given_result>0&&r.correct_answer>0&&e.correct++,r.correct_answer!==r.given_result&&r.given_result>0&&r.correct_answer>0&&e.wrong++,r.given_result>0&&e.solved++,r.given_result>-2&&e.seen++,1===r.type&&e.free++,0===r.correct_answer&&1!==r.type&&e.no_answer++}return e},t.prototype.saveAnswer=function(t,e){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].given_result=e,this.set(this.collection))},t.prototype.saveStrike=function(t,e){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].strike=e,this.set(this.collection))},t.prototype.saveMarkAnswer=function(t){this.collection&&Object.keys(this.collection).length&&(this.collection.list[t].mark_answer=1,this.set(this.collection))},t.prototype.prepareExam=function(t,e){var o=this;return this.API.get("exams/action/prepare/"+t,e).then(function(e){var n={list:e.data.list,exam_id:t};return o.set(n),n})},t.prototype.prepareSubjects=function(t){var e=this;return this.API.get("questions/prepare-subjects",t).then(function(o){var n={list:o.data.list,selection:t.selection};return e.set(n),n})},t.prototype.getIndexOfQuestion=function(t){for(var e=0;e<this.collection.list.length;e++)if(this.collection.list[e].question_id===t)return e;return-1},t.prototype.getQuestionData=function(t){return this.collection.list[t]},t.prototype.isHalftime=function(t){return Math.abs(t+1-this.collection.list.length/2)<1&&t>3},t}();angular.module("crucioApp").service("Collection",Collection);var Page=function(){function t(t){this.$window=t}return t.$inject=["$window"],t.prototype.setTitle=function(t){this.title=t},t.prototype.setNav=function(t){this.nav=t},t.prototype.setTitleAndNav=function(t,e){void 0===e&&(e=""),this.title=t,this.nav=e,this.$window.document.title=this.title},t}();angular.module("crucioApp").service("Page",Page);var DeleteResultsModalController=function(){function t(t,e,o){this.API=t,this.userId=e,this.$uibModalInstance=o}return t.$inject=["API","userId","$uibModalInstance"],t.prototype.deleteAllResults=function(){this.API.delete("results/"+this.userId),this.$uibModalInstance.close()},t}();angular.module("crucioApp").controller("deleteResultsModalController",DeleteResultsModalController);var DeleteTagsModalController=function(){function t(t,e,o){this.API=t,this.userId=e,this.$uibModalInstance=o}return t.$inject=["API","userId","$uibModalInstance"],t.prototype.deleteAllTags=function(){this.API.delete("tags/"+this.userId),this.$uibModalInstance.close()},t}();angular.module("crucioApp").controller("deleteTagsModalController",DeleteTagsModalController);var UserController=function(){function t(t,e,o,n,r){this.API=o,this.Auth=e,this.$scope=n,this.$uibModal=r,t.setTitleAndNav("Account | Crucio","User"),this.user=this.Auth.getUser()}return t.$inject=["Page","Auth","API","$scope","$uibModal"],t.prototype.formChanged=function(){this.isSaved=!1,this.hasError=!1,this.$scope.form.passwordc.$setValidity("confirm",this.newPassword===this.newPasswordC)},t.prototype.saveUser=function(){var t=this;this.formChanged(),this.isWorking=!0;var e={course_id:this.user.course_id,semester:this.user.semester,current_password:this.oldPassword,password:this.newPassword};this.API.put("users/"+this.user.user_id+"/account",e,!0).then(function(e){e.data.status?t.Auth.setUser(t.user):(t.user=t.Auth.getUser(),t.hasError=!0),t.isSaved=e.data.status,t.wrongPassword="error_incorrect_password"===e.data.error,t.isWorking=!1});var o={highlightExams:this.user.highlightExams,showComments:this.user.showComments,repetitionValue:50,useAnswers:this.user.useAnswers,useTags:this.user.useTags};this.API.put("users/"+this.user.user_id+"/settings",o,!0).then(function(e){e.data.status?t.Auth.setUser(t.user):(t.user=t.Auth.getUser(),t.hasError=!0),t.isSaved=e.data.status,t.isWorking=!1})},t.prototype.deleteAllResultsModal=function(){var t=this;this.$uibModal.open({templateUrl:"deleteResultsModalContent.html",controller:"deleteResultsModalController",controllerAs:"$ctrl",resolve:{userId:function(){return t.user.user_id}}})},t.prototype.deleteAllTagsModal=function(){var t=this;this.$uibModal.open({templateUrl:"deleteTagsModalContent.html",controller:"deleteTagsModalController",controllerAs:"$ctrl",resolve:{userId:function(){return t.user.user_id}}})},t}();angular.module("crucioApp").component("usercomponent",{templateUrl:"app/user/user.html",controller:UserController});